!function(H,a,_){"use strict";var e="ht",$=H[e],J=$.Default,S=$.graph,P=J.getInternal(),p=P.ui(),c=p.NodeUI.prototype,j=p.ShapeUI.prototype,r=S.GraphView,M=r.prototype,T=p.EdgeUI.prototype,Q=$.Node,y=$.Shape,A=$.Edge,B=$.Group,R=J.isTouchable,t=J.preventDefault,V=H.setTimeout,i=J.grow,n=J.isDragging,N=J.getDistance,x=null,W=$.List,D="undefined"!=typeof Float32Array?Float32Array:Array,z=Math,m=z.PI,f="Crossing",v="No Crossing",g=m/2,w=2*m,U=z.atan2,C=z.sqrt,s=z.pow,q=z.sin,F=z.cos,d=z.min,X=z.max,I=z.abs,E=z.ceil,Y=z.round,u=J.unionPoint,L=J.unionRect,K=J.containsPoint,O=J.clone,G="rgb(52, 152, 219)",h="red",l={northwest:0,north:1,northeast:2,west:7,east:3,southwest:6,south:5,southeast:4},k={width:400,height:100,comps:[{type:"shape",points:{func:function(){for(var R=[10,8,162,36,314,37,269,2,398,49,268,98,314,58,161,60,9,91,103,49,10,8],X=0;X<R.length;X++){var n=R[X];n=0===X%2?n/400*k.width:n/100*k.height,R[X]=n}return k.width>120&&(R[4]=k.width-26,R[6]=k.width-40,R[10]=k.width-40,R[12]=k.width-26,R[18]=33),R}},segments:[1,3,2,2,2,2,3,2,2],background:"white",gradient:"linear.east",gradientColor:"red"}]},b={width:300,height:300,comps:[{type:"circle",rect:[20,0,120,120],background:G,rotation:.61},{type:"circle",rect:[200,120,70,70],background:G,rotation:.61},{type:"circle",rect:[200,220,70,70],background:G,rotation:.61},{type:"shape",points:[80,60,80,155,200,155],borderWidth:20,borderColor:G},{type:"shape",points:[80,60,80,255,200,255],borderWidth:20,borderColor:G}]},Z={width:300,height:300,comps:[{type:"shape",points:[114,239,115,106,112,73,149,73,149,73,175,73,177,105,179,261,178,302,147,307,98,308,83,307,72,276,73,260,72,81,74,29,115,21,191,21,221,22,224,53,223,238],segments:[1,2,3,2,3,2,3,2,4,2,3,2,3,2],borderWidth:20,borderColor:h,rotation:.61}]},o={width:300,height:300,comps:[{type:"circle",rect:[210,0,90,90],background:G},{type:"circle",rect:[0,210,90,90],background:G},{type:"shape",points:[255,45,45,255],borderWidth:20,borderColor:G}]},Xd={width:300,height:300,comps:[{type:"shape",points:[20,20,280,280],borderWidth:30,borderColor:h},{type:"shape",points:[280,20,20,280],borderWidth:30,borderColor:h}]},Hp={width:300,height:300,comps:[{type:"shape",points:[270,30,30,150,270,270],borderWidth:40,borderColor:G}]},$l={width:300,height:300,comps:[{type:"shape",points:[30,30,270,150,30,270],borderWidth:40,borderColor:h}]},Tm={width:300,height:300,comps:[{type:"rect",rect:[125.58,52.76,40,231.96],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[27.87,61.06,150,30],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000",rotation:5.5},{type:"rect",rect:[113.36,61,150,30],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000",rotation:.79}]},vm={width:300,height:300,author:"",note:"",comps:[{type:"rect",rect:[135.15,38.76,28.63,82.84],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"triangle",rect:[94.69,2.35,110,44.77],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[31.71,115.72,240,15],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[31.71,167.62,240,15],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[135.15,177.33,28.63,82.84],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"triangle",rect:[94.69,251.39,110,44.77],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000",rotation:3.14}]},lq=function(i){var b=i.touches[0];return b?b:i.changedTouches[0]},em=function(Z,G,j,R){return U(R-G,j-Z)},Sc=function(i,l){return{x:i.x*l,y:i.y*l}},xd=function(S,R){var W,H,k,t,h=S._layers,U=S.sm().getSelection()._as,D=U.length;if(h)for(W=0;W<h.length;W++){t=h[W];for(var y=0;D>y;y++)if(H=U[y],H._layer===t&&(k=R(H),k===!1))return}else for(W=0;D>W;W++)if(H=U[W],k=R(H),k===!1)return},Qj=function(z,w,j){var r,g,_,U,P,H=this,k=w,c=H.gv;if(z instanceof y){_=z.getSegments();var A=c.getDataUI(z);P=A._55O.$15l,_&&_.size()||(_=pc(P)),z.isClosePath()&&_.indexOf(5)<0&&(_=new W(_._as),_.add(5)),r=sq(z,A,k),g=P[r]}else{var D=c.getDataUI(z);P=qh(D,z.s("edge.points")),_=z.s("edge.segments"),_&&_.size()||(_=pc(P)),P=P._as,r=sq(z,D,k),g=P[r]}if(_&&(U=_.get(k)),2===U||1===U||5===U){var f=P[r+1];5===U&&(f=P[0]);var Q=Ng(g,j,f);return Q}return j},yd=function(V,X){var Y,D,n,u,z=V._layers,e=V.sm().getSelection()._as,f=e.length;if(z)for(Y=z.length-1;Y>=0;Y--){u=z[Y];for(var y=f-1;y>=0;y--)if(D=e[y],D._layer===u&&(n=X(D),n===!1))return}else for(Y=f-1;Y>=0;Y--)if(D=e[Y],n=X(D),n===!1)return},pj=function(k,E,z,p){var t=E/2,y=z/2,m=rc(k,-t,-y,p),Z=rc(k,t,-y,p),C=rc(k,-t,y,p),L=rc(k,t,y,p),h=rc(k,0,-y,p),c=rc(k,t,0,p),U=rc(k,0,y,p),M=rc(k,-t,0,p);return[m,Z,C,L,h,c,U,M]},Ng=function(b,O,Y){var K={x:O.x-b.x,y:O.y-b.y},o={x:Y.x-b.x,y:Y.y-b.y},n=C(s(Y.x-b.x,2)+s(Y.y-b.y,2)),F={x:o.x/n,y:o.y/n},a=K.x*F.x+K.y*F.y,D={x:F.x*a,y:F.y*a};return{x:b.x+D.x,y:b.y+D.y}},rc=function(n,u,T,v){var r=F(v)*u-q(v)*T,c=q(v)*u+F(v)*T;return n?{x:n.x+r,y:n.y+c}:{x:r,y:c}},zj=function(F,Z){return Z>2*F?F:Z/2},vo=function(p,D,t,e){var S=N(p,D);return t=e?d(t,S):zj(t,S),S?t/=S:t=0,{x:p.x+(D.x-p.x)*t,y:p.y+(D.y-p.y)*t}},li=function(R,S){var q,Y,m=R.gv,M=R._data,v=M._40I,A=M._41I,k=M.s("edge.offset"),y=M.s("edge.source.position"),K=M.s("edge.target.position"),D=M.s("edge.source.offset.x"),w=M.s("edge.source.offset.y"),E=M.s("edge.target.offset.x"),n=M.s("edge.target.offset.y"),x=M.s("edge.source.anchor.x"),o=M.s("edge.source.anchor.y"),N=M.s("edge.target.anchor.x"),t=M.s("edge.target.anchor.y");if(S?(q=P.getEdgeAgentPosition(m,v,y,D,w,x,o),Y=P.getEdgeAgentPosition(m,A,K,E,n,N,t)):(q=P.getEdgeAgentPosition(m,v,y,0,0,x,o),Y=P.getEdgeAgentPosition(m,A,K,0,0,N,t)),"points"===M.s("edge.type")&&k&&!M.s("edge.center")&&q){var V=M.s("edge.points")||new W,Z=V.size(),T=vo(q,Z?V.get(0):Y,k,Z),a=vo(Y,Z?V.get(Z-1):q,k,Z);q=T,Y=a}return[q,Y]},qh=function(s,k,p){var e=s._78o,V=s._data,D=V.s("edge.type"),N=[e.sourcePoint,e.targetPoint];return"points"===D?p&&(N=li(s)):N=e.center?D?p?li(s):li(s,!0):p?li(s):[e.c1,e.c2]:p?li(s):li(s,!0),k=new W(k?k._as:x),k.add(N[0],0),k.add(N[1]),k},af=function(x){return x=new W(x._as),x.removeAt(0),x.removeAt(x.size()-1),x},pc=function(e){e._as||(e=new W(e));var N=new W;N.add(1);for(var A=1;A<e.size();A++)N.add(2);return N},dd=function(T,X){return{x:(T.x+X.x)/2,y:(T.y+X.y)/2}},Lg=function(o,X){return{x:o.x+1*(X.x-o.x)/4,y:o.y+1*(X.y-o.y)/4}},Ef=function(T,V){return{x:T.x+3*(V.x-T.x)/4,y:T.y+3*(V.y-T.y)/4}},mk=function(p,X,v,m){var f=X.x+X.width/2,P=X.y+X.height/2,N=C(f*f+P*P),y=U(P,f)+v;return{x:m.x+N*F(y),y:m.y+N*q(y)}},vk=M.validateImpl,Wf=M.isRectEditable,lh=M.isPointEditable,Hb=M._42,re=j._79o,Zl=T._79o,Vb=j._48O,Ae=j._47O,mf=c._48O,Pe=c._80o,_q=j._80o,gf=c.getSelectWidth,ip=c._47O,de=T._47O,Gq=M.isEditable,kp=["northwest","north","northeast","east","southeast","south","southwest","west"],Jk=function(Y,O,c,z,o,l,M,$,H,N){var j=Y.x,T=Y.y,A=Y.width,n=Y.height,h={x:j+A/2,y:T+n/2};z=z||0,O=rc(h,O.x-h.x,O.y-h.y,-z),M&&!$&&(O.x+=H,O.y+=N);var I=.01;if("northwest"===c?(O.x+o>j+A-I&&(O.x=j+A-o-I),O.y+o>T+n-I&&(O.y=T+n-o-I),Y=u(O,{x:j+A,y:T+n})):"north"===c?(O.y+o>T+n-I&&(O.y=T+n-o-I),Y=u({x:j,y:O.y},{x:j+A,y:T+n})):"northeast"===c?(O.x<j+o+I&&(O.x=j+o+I),O.y+o>T+n-I&&(O.y=T+n-o-I),Y=u({x:j,y:O.y},{x:O.x,y:T+n})):"west"===c?(O.x+o>j+A-I&&(O.x=j+A-o-I),Y=u({x:O.x,y:T},{x:j+A,y:T+n})):"east"===c?(O.x<j+o+I&&(O.x=j+o+I),Y=u({x:j,y:T},{x:O.x,y:T+n})):"southwest"===c?(O.x+o>j+A-I&&(O.x=j+A-o-I),O.y<T+o+I&&(O.y=T+o+I),Y=u({x:O.x,y:T},{x:j+A,y:O.y})):"south"===c?(O.y<T+o+I&&(O.y=T+o+I),Y=u({x:j,y:T},{x:j+A,y:O.y})):"southeast"===c&&(O.x<j+o+I&&(O.x=j+o+I),O.y<T+o+I&&(O.y=T+o+I),Y=u({x:j,y:T},O)),"keepRatio"===l&&(!M&&$||M&&!$)&&("northeast"===c||"southeast"===c||"northwest"===c||"southwest"===c)){var S=Y.width,L=Y.height,m=S/A,U=L/n,Z=d(m,U);Y.width=A*Z,Y.height=n*Z,"northeast"===c?Y.y=T+(n-Y.height):"northwest"===c?(Y.y=T+(n-Y.height),Y.x=j+(A-Y.width)):"southwest"===c&&(Y.x=j+(A-Y.width))}Y.x-=h.x,Y.y-=h.y;var C=mk(x,Y,z,h);return Y.x=C.x-Y.width/2,Y.y=C.y-Y.height/2,Y},ln=function(f,n,v,c){var m=f.getRotation(),N=n,W=N.x,D=N.y,b=N.width,j=N.height,L={x:W+N.width/2,y:D+N.height/2};c=rc(L,c.x-L.x,c.y-L.y,-m),"northwest"===v?N=u(c,{x:W+b,y:D+j}):"north"===v?N=u({x:W,y:c.y},{x:W+b,y:D+j}):"northeast"===v?N=u({x:W,y:c.y},{x:c.x,y:D+j}):"west"===v?N=u({x:c.x,y:D},{x:W+b,y:D+j}):"east"===v?N=u({x:W,y:D},{x:c.x,y:D+j}):"southwest"===v?N=u({x:c.x,y:D},{x:W+b,y:c.y}):"south"===v?N=u({x:W,y:D},{x:W+b,y:c.y}):"southeast"===v&&(N=u({x:W,y:D},c)),f.setRect(N),N.x-=L.x,N.y-=L.y;var q=mk(f,N,m,L);f.p(q.x,q.y)},ch=function(J,M,C,O,t,R,A,Y){var P=x;R?(P=rc(x,t.x-M.x,t.y-M.y,-C),P.x-=A.x,P.y-=A.y):P=rc(x,t.x-M.x,t.y-M.y,0);var $={x:M.x+P.x,y:M.y+P.y};Y&&($=Y($.x,$.y)),$.e=J.getPoints().get(O).e,J.setPoint(O,$);var E=J.getWidth(),z=J.getHeight(),F=J.p().x-E/2,r=J.p().y-z/2;F-=M.x,r-=M.y;var B=mk(J,{x:F,y:r,width:E,height:z},C,M);J.p(B.x,B.y)},sq=function(M,x,F){var q,l;if(M instanceof y?(q=M.getPoints(),l=M.getSegments()):M instanceof A&&"points"===M.s("edge.type")&&(q=M.s("edge.points"),l=M.s("edge.segments"),q=qh(x,q)),l&&l.size()||(l=pc(q)),M instanceof y&&M.isClosePath()&&l.indexOf(5)<0&&(l=new W(l._as),l.add(5)),l)for(var i=-1,C=0;C<l.size();C++){if(C===F)return i;var G=l.get(C);1===G?i+=1:2===G?i+=1:3===G?i+=2:4===G&&(i+=3)}},jb=function(Z,O,D){var X,F;if(Z instanceof y?(X=Z.getPoints(),F=Z.getSegments()):Z instanceof A&&"points"===Z.s("edge.type")&&(X=Z.s("edge.points"),F=Z.s("edge.segments"),X=qh(O,X)),F&&F.size()||(F=pc(X)),F)for(var c=-1,M=0;M<F.size();M++){var R=F.get(M);if(1===R?c+=1:2===R?c+=1:3===R?c+=2:4===R&&(c+=3),c===D)return M}},fk=function(B,v){var z=[B[0]-v[0],B[1]-v[1],B[2]-v[2]];return z},lk=function(){var o=new D(16);return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},Rc=function(u,U){var d=u[0],C=u[1],$=u[2];return u[0]=U[0]*d+U[4]*C+U[8]*$+U[12],u[1]=U[1]*d+U[5]*C+U[9]*$+U[13],u[2]=U[2]*d+U[6]*C+U[10]*$+U[14],u},No=function(d,O){if(O){var J=q(O),Y=F(O),Z=d[0],s=d[1],X=d[2],m=d[3],h=d[8],r=d[9],n=d[10],M=d[11];d[0]=Z*Y-h*J,d[1]=s*Y-r*J,d[2]=X*Y-n*J,d[3]=m*Y-M*J,d[8]=Z*J+h*Y,d[9]=s*J+r*Y,d[10]=X*J+n*Y,d[11]=m*J+M*Y}},Ln=function(p,v){for(var s=p.s("grid.row.count"),D=p.s("grid.column.count"),e=0;s>e;e++)for(var W=0;D>W;W++){var j=p.getCellRect(e,W);if(K(j,v))return{rowIndex:e,columnIndex:W,rect:j,grid:p}}return null},ji=function(V,H,U,M,l,O){var c={},A=U-V,q=M-H,F=z.sqrt(A*A+q*q),I=A/F,u=q/F,E=(-V+l)*I+(-H+O)*u;return 0>=E?(c.x=V,c.y=H):E>=F?(c.x=U,c.y=M):(c.x=V+E*I,c.y=H+E*u),A=l-c.x,q=O-c.y,c.z=z.sqrt(A*A+q*q),c},Bn=function(q,n){var k,D,R,O,U,b,u,B,I=q.getPoints(),s=q.getSegments(),T=q.p(),C=q.getRotation();if(!s||!(s.indexOf(3)>0||s.indexOf(4)>0)){for(B=0;B<=I.size()-1;B++)if(B===I.size()-1?(U=I.get(0),O=I.get(B)):(O=I.get(B),U=I.get(B+1)),O=rc(T,O.x-T.x,O.y-T.y,C),U=rc(T,U.x-T.x,U.y-T.y,C),b=ji(O.x,O.y,U.x,U.y,n.x,n.y),u=b.z,u<(q.s("shape.border.width")||10)){D=O,R=U,k=B;break}if(k!=x){var F=ji(D.x,D.y,R.x,R.y,n.x,n.y),r=N(D,F);return{attachIndex:k,attachOffset:r}}}},jn=function(Z){for(var X=Z._data,o=X.p(),E=X.getRotation(),e=X.getPoints(),c=x,i=[],I=0;I<e.size();I++)c=e.get(I),i.push(rc(o,c.x-o.x,c.y-o.y,E));Z._55O.$15l=i};J.setImage("xeditinteractor_parentIcon",b),J.setImage("xeditinteractor_hostIcon",Z),J.setImage("xeditinteractor_edgeIcon",o),J.setImage("xeditinteractor_removeIcon",Xd),J.setImage("xeditinteractor_sourceIcon",Hp),J.setImage("xeditinteractor_targetIcon",$l),J.setImage("xeditinteractor_elevationIcon",Tm),J.setImage("xeditinteractor_tallIcon",vm),M._editPointSize=R?24:9,M._edgeHelpers=["parent","remove","source","target"],M._leftTopHelpers=["parent"],M._rightTopHelpers=["host"],M._leftBottomHelpers=["edge"],M._rightBottomHelpers=["remove"],kp=kp.concat(kp).concat(kp),T._79o=function(){var K=this,z=K.gv,U=z.getZoom(),_=z._editInteractor,x=Zl.call(K);if(!x)return null;var G=li(K,!0),o=G[0],A=G[1],m={x:x.x,y:x.y,width:x.width,height:x.height},X=u(o,A);if(_ instanceof S.XEditInteractor){m=L(m,X);var v=K._55O,s=z.getEditPointSize()/U+2,d=0;v&&v._43O&&(d+=s/2,i(m,d))}return m},T._47O=function(Z){var R=this,t=R.gv,x=t._editInteractor;x instanceof S.XEditInteractor||de.call(R,Z)},T.rectIntersects=function(N){var d=this,i=d._data,Y=d.gv,l=Y.getZoom(),W=d._55O,A=Y._editInteractor;if(A instanceof S.XEditInteractor&&Y.isEditable(i)&&W&&W._43O&&"points"===i.s("edge.type")){var J=i.s("edge.points"),e=i.s("edge.segments");J=qh(d,J),e&&e.size()||(e=pc(J)),J=J._as;var C=!1,h=R?5:1,r=N.x+h,O=N.y+h,V={x:r,y:O};if(A._edge===i&&A._hoverSegmentIndex>=0){var K=Y._editInteractor._hoverSegmentIndex,I=e.get(K),B=sq(i,d,K),L=x;if(B!=x&&B>=0){var s=J[B],w=Y.getSegmentHoverWidth()/l;if(2===I||1===I){var G=J[B+1];L=Jm(new al(s.x,s.y),new al(G.x,G.y),new al(V.x-w,V.y-w),new al(V.x+2*w,V.y+2*w)),L.$62l===f&&(C=!0)}else if(3===I){var t=J[B+1],G=J[B+2];L=ll(new al(s.x,s.y),new al(t.x,t.y),new al(G.x,G.y),new al(V.x-w,V.y-w),new al(V.x+2*w,V.y+2*w)),L.$62l===f&&(C=!0)}else if(4===I){var M=J[B+1],Z=J[B+2];G=J[B+3],L=Mc(new al(s.x,s.y),new al(M.x,M.y),new al(Z.x,Z.y),new al(G.x,G.y),new al(V.x-w,V.y-w),new al(V.x+2*w,V.y+2*w)),L.$62l===f&&(C=!0)}}}if(C)return!0}return x},j._47O=function(N){var c=this,l=c.gv,T=l._editInteractor;T instanceof S.XEditInteractor||Ae.call(c,N)},j.rectIntersects=function(P){var T=this,d=T._data,B=T.gv,G=B.getZoom(),$=T._55O,o=B._editInteractor;if(o instanceof S.XEditInteractor&&B.isEditable(d)&&$&&$._43O){var t=$.$15l,n=!1,c=R?5:1,I=P.x+c,N=P.y+c,y={x:I,y:N};if(t&&t.length===d.getPoints().size()||(jn(T),t=$.$15l),o._shape===d&&o._hoverSegmentIndex>=0){var J=d.getSegments();J&&J.size()||(J=pc(t));var Q=B._editInteractor._hoverSegmentIndex,M=J.get(Q),L=sq(d,T,Q),z=x;if(L!=x&&L>=0){var U=t[L],O=B.getSegmentHoverWidth()/G;if(2===M||1===M){var A=t[L+1];z=Jm(new al(U.x,U.y),new al(A.x,A.y),new al(y.x-O,y.y-O),new al(y.x+2*O,y.y+2*O)),z.$62l===f&&(n=!0)}else if(3===M){var C=t[L+1],A=t[L+2];z=ll(new al(U.x,U.y),new al(C.x,C.y),new al(A.x,A.y),new al(y.x-O,y.y-O),new al(y.x+2*O,y.y+2*O)),z.$62l===f&&(n=!0)}else if(4===M){var w=t[L+1],W=t[L+2];A=t[L+3],z=Mc(new al(U.x,U.y),new al(w.x,w.y),new al(W.x,W.y),new al(A.x,A.y),new al(y.x-O,y.y-O),new al(y.x+2*O,y.y+2*O)),z.$62l===f&&(n=!0)}}}if(n)return!0}return x},j._48O=function(){var A=this,b=A.gv,t=b._editInteractor;t instanceof S.XEditInteractor?(c._48O.call(A),A._55O._43O&&jn(A)):Vb.call(A)},j._79o=function(){var B=this,R=B.gv,a=R.getZoom(),O=R._editInteractor,K=re.call(B);if(K){var U={x:K.x,y:K.y,width:K.width,height:K.height};if(O instanceof S.XEditInteractor){var n=B._55O,F=R.getEditPointSize()/a+2,Y=0;n&&n._43O&&(Y+=F/2,i(U,Y))}return U}},c._47O=function(o){var W=this,I=W.gv,i=I._editInteractor;if(i instanceof S.XEditInteractor);else{var c=W._55O;c&&c._98o&&ip.call(W,o)}},c.getSelectWidth=function(){var Y=this,n=Y.gv,J=n._editInteractor,b=Y._data;return n.isEditable(b)&&J instanceof S.XEditInteractor?0:gf.call(Y)},c._80o=function(f){var Y=this,o=Y.gv._editInteractor;if(Pe.call(Y,f),o&&o._debug){f.save(),f.beginPath(),f.lineWidth=1,f.strokeStyle="green";var C=Y._79o();C&&(f.rect(C.x,C.y,C.width,C.height),f.stroke()),f.restore()}},j._80o=function(K){var Y=this,b=Y.gv._editInteractor;if(_q.call(Y,K),b&&b._debug){K.save(),K.beginPath(),K.lineWidth=1,K.strokeStyle="green";var $=Y._79o();K.rect($.x,$.y,$.width,$.height),K.stroke(),K.restore()}},c._48O=function(){var m=this,q=m.gv,W=m._data,g=q._editInteractor,J=m._55O,L=W.p(),_=W.getRotation();if(g instanceof S.XEditInteractor){if(J._42O){var u=pj(L,W.getWidth(),W.getHeight(),_),l=u[0],i=u[1],h=u[2],G=u[3],E=u[4],r=u[5],d=u[6],R=u[7];J.$45l=[l,E,i,r,G,d,h,R]}}else mf.call(m)},M.getResizeMode=function(){return this.$25l||"normal"},M.setResizeMode=function(w){var v=this.$25l;this.$25l=w,this.fp("resizeMode",v,w)},M.getSnapAngle=function(){return this.$26l||Math.PI/36},M.setSnapAngle=function(l){var k=this.$26l;this.$26l=l,this.fp("snapAngle",k,l)},M.getSnapSpacing=function(){return this.$27l},M.setSnapSpacing=function(f){var x=this.$27l;this.$27l=f,this.fp("snapSpacing",x,f)},M.getPointSnapSpacing=function(){return this._pointSnapSpacing},M.setPointSnapSpacing=function(G){var C=this._pointSnapSpacing;this._pointSnapSpacing=G,this.fp("pointSnapSpacing",C,G)},M.setHelperEditableFunc=function(l){var L=this._helperEditableFunc;this._helperEditableFunc=l,this.fp("helperEditableFunc",L,l)},M.getHelperEditableFunc=function(){return this._helperEditableFunc},M.setLeftTopHelpers=function($){var H=this._leftTopHelpers;this._leftTopHelpers=$,this.fp("leftTopHelpers",H,$)},M.getLeftTopHelpers=function(){return this._leftTopHelpers},M.setLeftTopHelpersAlign=function(w){var S=this._leftTopHelpersAlign;this._leftTopHelpersAlign=w,this.fp("leftTopHelpersAlign",S,w)},M.getLeftTopHelpersAlign=function(){return this._leftTopHelpersAlign},M.setRightTopHelpers=function(y){var n=this._rightTopHelpers;this._rightTopHelpers=y,this.fp("rightTopHelpers",n,y)},M.getRightTopHelpers=function(){return this._rightTopHelpers},M.setRightTopHelpersAlign=function(C){var R=this._rightTopHelpersAlign;this._rightTopHelpersAlign=C,this.fp("rightTopHelpersAlign",R,C)},M.getRightTopHelpersAlign=function(){return this._rightTopHelpersAlign},M.setLeftBottomHelpers=function(S){var f=this._leftBottomHelpers;this._leftBottomHelpers=S,this.fp("leftBottomHelpers",f,S)},M.getLeftBottomHelpers=function(){return this._leftBottomHelpers},M.setLeftBottomHelpersAlign=function(b){var f=this._leftBottomHelpersAlign;this._leftBottomHelpersAlign=b,this.fp("leftBottomHelpersAlign",f,b)},M.getLeftBottomHelpersAlign=function(){return this._leftBottomHelpersAlign},M.setRightBottomHelpers=function(R){var N=this._rightBottomHelpers;this._rightBottomHelpers=R,this.fp("rightBottomHelpers",N,R)},M.getRightBottomHelpers=function(){return this._rightBottomHelpers},M.setRightBottomHelpersAlign=function(q){var W=this._rightBottomHelpersAlign;this._rightBottomHelpersAlign=q,this.fp("rightBottomHelpersAlign",W,q)},M.getRightBottomHelpersAlign=function(){return this._rightBottomHelpersAlign},M.setEdgeHelpers=function(z){var h=this._edgeHelpers;this._edgeHelpers=z,this.fp("edgeHelpers",h,z)},M.getEdgeHelpers=function(){return this._edgeHelpers},M.isHelperEditable=function(a,z){return a instanceof A&&("host"===z||"edge"===z||"elevation"===z||"tall"===z)?!1:a instanceof Q&&("source"===z||"target"===z)?!1:"pointElevation"===z?this._helperEditableFunc?this._helperEditableFunc(a,z):!1:this._helperEditableFunc?this._helperEditableFunc(a,z):!0},M.getEditHelperSize=function(){return this._editHelperSize||(R?28:16)},M.setEditHelperSize=function(c){var g=this._editHelperSize;this._editHelperSize=c,this.fp("editHelperSize",g,c)},M.getEditRectBorderColor=function(){return this.$28l||"rgb(0, 168, 255)"},M.setEditRectBorderColor=function(V){var M=this.$28l;this.$28l=V,this.fp("editRectBorderColor",M,V)},M.getNodeBorderColor=function(){return this.$29l||"#1ABC9C"},M.setNodeBorderColor=function(l){var V=this.$29l;this.$29l=l,this.fp("nodeBorderColor",V,l)},M.getEditRectBorderStyle=function(){return this.$30l||"dashed"},M.setEditRectBorderStyle=function(B){var j=this.$30l;this.$30l=B,this.fp("editRectBorderStyle",j,B)},M.getControlPointBackground=function(){return this.$31l||"#ff0"},M.setControlPointBackground=function(H){var X=this.$31l;this.$31l=H,this.fp("controlPointBackground",X,H)},M.getControlPointBorderColor=function(){return this.$32l||this._editPointBorderColor},M.setControlPointBorderColor=function(h){var s=this.$32l;this.$32l=h,this.fp("controlPointBorderColor",s,h)},M.getJoinPointBackground=function(){return this.$33l||this._editPointBackground},M.setJoinPointBackground=function(l){var C=this.$33l;this.$33l=l,this.fp("joinPointBackground",C,l)},M.getJoinPointBorderColor=function(){return this.$34l||this._editPointBorderColor},M.setJoinPointBorderColor=function(Z){var n=this.$34l;this.$34l=Z,this.fp("joinPointBorderColor",n,Z)},M.getDirectionLineColor=function(){return this.$35l||"#888"},M.setDirectionLineColor=function(C){var c=this.$35l;this.$35l=C,this.fp("directionLineColor",c,C)},M.getSegmentHoverColor=function(){return this.$36l||"rgba(255, 0, 0, 0.3)"},M.setSegmentHoverColor=function(c){var E=this.$36l;this.$36l=c,this.fp("segmentHoverColor",E,c)},M.getSegmentHoverWidth=function(){return this.$22l||(R?16:8)},M.setSegmentHoverWidth=function(B){var C=this.$22l;this.$22l=B,this.fp("segmentHoverWidth",C,B)},M.getSnapPointBorderColor=function(){return this.$38l||"#f00"},M.setSnapPointBorderColor=function(J){var b=this.$38l;this.$38l=J,this.fp("snapPointBorderColor",b,J)},M.getEditRectPadding=function(){return this.$39l!=x?this.$39l:6},M.setEditRectPadding=function(S){var H=this.$39l;this.$39l=S,this.fp("editRectPading",H,S)},M.isRectEditable=function(E){var I=this,r=I._editInteractor;return r instanceof S.XEditInteractor?I._rectEditableFunc?I._rectEditableFunc(E):!0:Wf.call(I,E)},M.isPointEditable=function(T){var J=this,G=J._editInteractor;return G instanceof S.XEditInteractor?J._pointEditableFunc?J._pointEditableFunc(T):!0:lh.call(J,T)},M.validateImpl=function(){var A=this,W=A.$14l,N=A._editInteractor;if(W){var I=A.getWidth(),t=A.getHeight();(I!==W.clientWidth||t!==W.clientHeight)&&(N&&(N._68I=1),P.setCanvas(W,I,t),A._32I=1)}vk.call(this)},M.isEditable=function(w){var d=Gq.call(this,w),a=this._editInteractor;if(a instanceof S.XEditInteractor&&w instanceof A){if(!w.s("2d.editable"))return!1;var _=this.getEditableFunc();d=_?_(w):!0}return d},M._42=function(f,t){var Q=this,i=Q._editInteractor;Hb.call(Q,f,t),i instanceof S.XEditInteractor&&i._68I&&i._42()},M.isSnapPoint=function(){return!0};var Sl=function(O){arguments.length>0&&this.$58l(O)},sk=Sl.prototype;sk.$58l=function(A){this.$62l=A,this.points=new Array},sk.$56l=function(l){this.points.push(l)},sk.$57l=function(W){this.points=this.points.concat(W)};var al=function(H,J){arguments.length>0&&this.$58l(H,J)},Cm=al.prototype;Cm.$58l=function(W,K){this.x=W,this.y=K},Cm.add=function(L){return new al(this.x+L.x,this.y+L.y)},Cm.addEquals=function(W){return this.x+=W.x,this.y+=W.y,this},Cm.$55l=function(C){return new al(this.x*C,this.y*C)},Cm.eq=function(J){return this.x==J.x&&this.y==J.y},Cm.lt=function(a){return this.x<a.x&&this.y<a.y},Cm.lte=function(W){return this.x<=W.x&&this.y<=W.y},Cm.gt=function(J){return this.x>J.x&&this.y>J.y},Cm.gte=function(I){return this.x>=I.x&&this.y>=I.y},Cm.lerp=function(N,x){return new al(this.x+(N.x-this.x)*x,this.y+(N.y-this.y)*x)},Cm.distanceFrom=function(W){var z=this.x-W.x,B=this.y-W.y;return C(z*z+B*B)},Cm.min=function(R){return new al(d(this.x,R.x),d(this.y,R.y))},Cm.max=function(b){return new al(X(this.x,b.x),X(this.y,b.y))},Cm.toString=function(){return this.x+","+this.y};var Pm=function(){this.$58l(arguments)},qo=Pm.prototype;Pm.TO=1e-6,Pm.AC=6,qo.$58l=function(v){this.co=new Array;for(var g=v.length-1;g>=0;g--)this.co.push(v[g])},qo.$55l=function(y){for(var C=new Pm,u=0;u<=this.$50l()+y.$50l();u++)C.co.push(0);for(var u=0;u<=this.$50l();u++)for(var p=0;p<=y.$50l();p++)C.co[u+p]+=this.co[u]*y.co[p];return C},qo.$59l=function(){for(var K=this.$50l();K>=0&&I(this.co[K])<=Pm.TO;K--)this.co.pop()},qo.$50l=function(){return this.co.length-1},qo.$51l=function(){var g;switch(this.$59l(),this.$50l()){case 0:g=new Array;break;case 1:g=this.$52l();break;case 2:g=this.$53l();break;case 3:g=this.$54l();break;case 4:g=this.$63l();break;default:g=new Array}return g},qo.$52l=function(){var O=new Array,x=this.co[1];return 0!=x&&O.push(-this.co[0]/x),O},qo.$53l=function(){var B=new Array;if(2==this.$50l()){var O=this.co[2],c=this.co[1]/O,T=this.co[0]/O,f=c*c-4*T;if(f>0){var n=C(f);B.push(.5*(-c+n)),B.push(.5*(-c-n))}else 0==f&&B.push(.5*-c)}return B},qo.$63l=function(){var Z=new Array;if(4==this.$50l()){var R=this.co[4],P=this.co[3]/R,y=this.co[2]/R,S=this.co[1]/R,l=this.co[0]/R,Q=new Pm(1,-y,P*S-4*l,-P*P*l+4*y*l-S*S).$54l(),r=Q[0],U=P*P/4-y+r;if(I(U)<=Pm.TO&&(U=0),U>0){var $=C(U),N=3*P*P/4-$*$-2*y,M=(4*P*y-8*S-P*P*P)/(4*$),L=N+M,x=N-M;if(I(L)<=Pm.TO&&(L=0),I(x)<=Pm.TO&&(x=0),L>=0){var t=C(L);Z.push(-P/4+($+t)/2),Z.push(-P/4+($-t)/2)}if(x>=0){var t=C(x);Z.push(-P/4+(t-$)/2),Z.push(-P/4-(t+$)/2)}}else if(0>U);else{var M=r*r-4*l;if(M>=-Pm.TO){if(0>M&&(M=0),M=2*C(M),N=3*P*P/4-2*y,N+M>=Pm.TO){var v=C(N+M);Z.push(-P/4+v/2),Z.push(-P/4-v/2)}if(N-M>=Pm.TO){var v=C(N-M);Z.push(-P/4+v/2),Z.push(-P/4-v/2)}}}}return Z},qo.$54l=function(){var n=new Array;if(3==this.$50l()){var k=this.co[3],r=this.co[2]/k,z=this.co[1]/k,v=this.co[0]/k,O=(3*z-r*r)/3,x=(2*r*r*r-9*z*r+27*v)/27,Y=r/3,L=x*x/4+O*O*O/27,u=x/2;if(I(L)<=Pm.TO&&(L=0),L>0){var b,X,G=C(L);b=-u+G,X=b>=0?s(b,1/3):-s(-b,1/3),b=-u-G,b>=0?X+=s(b,1/3):X-=s(-b,1/3),n.push(X-Y)}else if(0>L){var D=C(-O/3),l=U(C(-L),-u)/3,t=F(l),m=q(l),R=C(3);n.push(2*D*t-Y),n.push(-D*(t+R*m)-Y),n.push(-D*(t-R*m)-Y)}else{var b;b=u>=0?-s(u,1/3):s(-u,1/3),n.push(2*b-Y),n.push(-b-Y)}}return n};var Eb=function(i,N){arguments.length>0&&this.$58l(i,N)},wn=Eb.prototype;wn.$58l=function(s,K){this.x=s,this.y=K},wn.length=function(){return C(this.x*this.x+this.y*this.y)},wn.$60l=function(Y){return this.x*Y.x+this.y*Y.y};var Yk=function(p,M,Y,b){var T,C=(b.x-Y.x)*(p.y-Y.y)-(b.y-Y.y)*(p.x-Y.x),o=(M.x-p.x)*(p.y-Y.y)-(M.y-p.y)*(p.x-Y.x),Z=(b.y-Y.y)*(M.x-p.x)-(b.x-Y.x)*(M.y-p.y);if(0!=Z){var g=C/Z,c=o/Z;g>=0&&1>=g&&c>=0&&1>=c?(T=new Sl(f),T.points.push(new al(p.x+g*(M.x-p.x),p.y+g*(M.y-p.y)))):T=new Sl(v)}else T=0==C||0==o?new Sl("C"):new Sl("P");return T},Vi=function(b,l,M,P,g){var i,G,z,o,c,r,O,$=P.min(g),a=P.max(g),I=new Sl(v);i=l.$55l(-2),z=b.add(i.add(M)),i=b.$55l(-2),G=l.$55l(2),o=i.add(G),c=new al(b.x,b.y),O=new Eb(P.y-g.y,g.x-P.x),r=P.x*g.y-g.x*P.y;for(var h=new Pm(O.$60l(z),O.$60l(o),O.$60l(c)+r).$51l(),R=0;R<h.length;R++){var V=h[R];if(V>=0&&1>=V){var C=b.lerp(l,V),Q=l.lerp(M,V),k=C.lerp(Q,V);P.x==g.x?$.y<=k.y&&k.y<=a.y&&(I.$62l=f,I.$56l(k)):P.y==g.y?$.x<=k.x&&k.x<=a.x&&(I.$62l=f,I.$56l(k)):k.gte($)&&k.lte(a)&&(I.$62l=f,I.$56l(k))}}return I},ll=function(K,X,o,j,r){var b=j.min(r),I=j.max(r),Q=new al(I.x,b.y),n=new al(b.x,I.y),D=Vi(K,X,o,b,Q),S=Vi(K,X,o,Q,I),d=Vi(K,X,o,I,n),Z=Vi(K,X,o,n,b),N=new Sl(v);return N.$57l(D.points),N.$57l(S.points),N.$57l(d.points),N.$57l(Z.points),N.points.length>0&&(N.$62l=f),N},Ip=function(_,O,b,J,p,P){var e,g,G,T,L,Q,I,j,U,o,z=p.min(P),F=p.max(P),E=new Sl(v);e=_.$55l(-1),g=O.$55l(3),G=b.$55l(-3),T=e.add(g.add(G.add(J))),L=new Eb(T.x,T.y),e=_.$55l(3),g=O.$55l(-6),G=b.$55l(3),T=e.add(g.add(G)),Q=new Eb(T.x,T.y),e=_.$55l(-3),g=O.$55l(3),G=e.add(g),I=new Eb(G.x,G.y),j=new Eb(_.x,_.y),o=new Eb(p.y-P.y,P.x-p.x),U=p.x*P.y-P.x*p.y;for(var c=new Pm(o.$60l(L),o.$60l(Q),o.$60l(I),o.$60l(j)+U).$51l(),u=0;u<c.length;u++){var R=c[u];if(R>=0&&1>=R){var X=_.lerp(O,R),m=O.lerp(b,R),d=b.lerp(J,R),l=X.lerp(m,R),H=m.lerp(d,R),$=l.lerp(H,R);p.x==P.x?z.y<=$.y&&$.y<=F.y&&(E.$62l=f,E.$56l($)):p.y==P.y?z.x<=$.x&&$.x<=F.x&&(E.$62l=f,E.$56l($)):$.gte(z)&&$.lte(F)&&(E.$62l=f,E.$56l($))}}return E},Mc=function(H,r,C,B,e,O){var p=e.min(O),x=e.max(O),K=new al(x.x,p.y),c=new al(p.x,x.y),$=Ip(H,r,C,B,p,K),h=Ip(H,r,C,B,K,x),A=Ip(H,r,C,B,x,c),s=Ip(H,r,C,B,c,p),Z=new Sl(v);return Z.$57l($.points),Z.$57l(h.points),Z.$57l(A.points),Z.$57l(s.points),Z.points.length>0&&(Z.$62l=f),Z},Jm=function(i,s,U,R){var q=U.min(R),u=U.max(R),t=new al(u.x,q.y),r=new al(q.x,u.y),H=Yk(q,t,i,s),l=Yk(t,u,i,s),z=Yk(u,r,i,s),Q=Yk(r,q,i,s),g=new Sl(v);return g.$57l(H.points),g.$57l(l.points),g.$57l(z.points),g.$57l(Q.points),g.points.length>0&&(g.$62l=f),g},Zi=S.XEditInteractor=function(V){var Y=this,l=Y._view=document.createElement("canvas");l.className="editCanvas",l.style.position="absolute",Zi.superClass.constructor.call(Y,V)};J.def(Zi,S.Interactor,{ms_edit:1,setUp:function(){var q=this,t=q.gv,b=t.getView(),p=q._view;Zi.superClass.setUp.call(q),t.setEditInteractor(q),t.$14l=p,t._79O?b.insertBefore(p,t._79O):b.appendChild(p);var d=q.$49l=q.$11l.bind(q);t.dm().md(d),t.sm().ms(d),t.mp(d)},tearDown:function(){var i=this,B=i.gv,m=B.getView(),F=i.$49l;Zi.superClass.tearDown.call(i),B.setEditInteractor(x),B.$14l=x,m.removeChild(i._view),B.dm().umd(F),B.sm().ums(F),B.ump(F)},clear:function(){var Y=this,e=Y.gv;delete Y._hoverSegmentIndex,delete Y._edge,delete Y._shape,delete e._editing,delete Y.$10l,delete Y.$13l,delete Y.$9l,delete Y._removePointIndex,delete Y._lp,Y.$12l="",delete Y.$40l,delete Y.$67l,delete Y.$72l,delete Y.$73l,delete Y.$75l,delete Y.$1l,delete Y.$3l,delete Y.$2l,delete Y.$92l,delete Y.$93l,delete Y.$94l,Y.clearDragging()},handle_keydown:function(Q){this.$48l!==Q.shiftKey&&(this.$48l=Q.shiftKey,this.handle_mousemove(Q,_,!0))},handle_keyup:function($){this.$48l!==$.shiftKey&&(this.$48l=$.shiftKey,this.handle_mousemove($,_,!0))},handle_touchstart:function(h){this.handle_mousemove(h),this.handle_mousedown(h)},handle_mousedown:function(d){t(d);var e=this,c=e.$13l,B=e.gv,x=B.dm(),T=x.getHistoryManager(),n=B.sm(),N=B.getZoom(),o=B.lp(d),K=J.isDoubleClick(d),z=J.isLeftButton(d),W=e.$7l,y=e._shape,F=e._hoverSegmentIndex,G=e._edge,q=e.$87l,D=e.$88l,S=function(){e._68I||q===e.$87l&&D===e.$88l||e.$43l()};if(7!==e.$67l&&(delete e.$87l,delete e.$88l),z&&(y||G)&&F>=0&&K&&(y&&n.contains(y)||G&&n.contains(G))){var u=Qj.call(e,y||G,F,o);return e.addShapePoint(y||G,F,u),V(function(){e.handle_mousemove(d)},40),void 0}if(z&&(y||G)&&e._removePointIndex>=0&&K)return e.removeShapePoint(),e.$5l=1,V(function(){e.handle_mousemove(d)},40),void 0;if(!z||!B._editing)return S(),void 0;if(y&&c>=0){var A=y.getPoints().get(c),R=y.p(),w=rc(R,A.x-R.x,A.y-R.y,-W+y.getRotation());U=rc(R,o.x-R.x,o.y-R.y,-W),e.$24l={x:U.x-w.x,y:U.y-w.y},e.startDragging(d),T&&T.beginInteraction(),e.fi({kind:"beginEditPoint",event:d,data:y,index:c}),e.$88l=c,e.$87l=y}else if(e.$10l){var s=B.sm().getSelection(),k=e.$6l,h=e.$1l={},I=e.$3l={},f=e.$16l[l[e.$10l]],_={x:k.x,y:k.y},$={x:k.x+k.width/2,y:k.y+k.height/2};e.$24l={x:o.x-f.x/N,y:o.y-f.y/N},e.$2l=O(e.$8l),e.$4l=O(k),s.each(function(t){if(t instanceof Q){var K=t.p(),F=t.getWidth(),B=t.getHeight(),G=rc($,K.x-$.x,K.y-$.y,-W);h[t.getId()]={x:K.x-F/2,y:K.y-B/2,width:F,height:B},I[t.getId()]={x:(G.x-_.x)/k.width,y:(G.y-_.y)/k.height}}}),e.startDragging(d),T&&T.beginInteraction(),e.fi({kind:"beginEditRect",event:d,direction:e.$10l})}else if(G&&c>=0){var a=qh(B.getDataUI(G),G.s("edge.points")),A=a.get(c);e.$24l={x:o.x-A.x,y:o.y-A.y},e.startDragging(d),T&&T.beginInteraction(),e.fi({kind:"beginEditPoint",event:d,data:G,index:c}),e.$88l=c,e.$87l=G}else if(e.$40l){var k=e.$6l,$={x:k.x+k.width/2,y:k.y+k.height/2},E=O(e.$23l);E.x/=N,E.y/=N;var X=rc($,E.x-$.x,E.y-$.y,-W),U=rc($,o.x-$.x,o.y-$.y,-W);e.$24l={x:U.x-X.x,y:U.y-X.y},e.startDragging(d),T&&T.beginInteraction(),e.fi({kind:"beginEditRotation",event:d,data:e._rotationNode})}else if([1,2,3,5,6,7,8,9].indexOf(e.$67l)>=0){var i=e.$67l;(7===i||8===i||9===i)&&T&&T.beginInteraction(),e.startDragging(d)}else if(e.$71l&&K&&e.$79l(e.$71l,o)){var r=n.toSelection();T&&T.beginInteraction(),r.each(function(W){x.remove(W)}),T&&T.endInteraction()}S()},$11l:function(){var C=this,N=C.gv;N._editing&&(C.$13l==x||C._shape==x&&C._edge==x)&&(C.$73l==x||1!==C.$67l&&5!==C.$67l&&6!==C.$67l)||(C.$5l=1),C._68I=1},$46l:function(r){var L=this,T=L.gv,w=T.lp(r),S=[];return yd(T,function(Q){var V=T.getDataUI(Q);if(V){var O=V._79o();K(O,w)&&S.push(Q)}}),S},$47l:function(S){var A=this,i=A.$13l,U=A.gv.dm(),w=U.getHistoryManager();A.$10l?(A.fi({kind:"endEditRect",event:S,direction:A.$10l}),w&&w.endInteraction()):A._shape&&i>=0?(A.fi({kind:"endEditPoint",event:S,data:A._shape,index:i}),w&&w.endInteraction()):A._edge&&i>=0?(A.fi({kind:"endEditPoint",event:S,data:A._edge,index:i}),w&&w.endInteraction()):A.$23l&&A.$40l&&(A.fi({kind:"endEditRotation",event:S}),w&&w.endInteraction())},handleWindowTouchEnd:function(R){this.handleWindowMouseUp(R)},handleWindowMouseUp:function(J){var i=this,j=i.gv,O=j.dm(),P=O.getHistoryManager(),M=i._shape,n=i._edge,p=i.$13l,y=i.$40l,h=i.$9l,S=i.$10l,B=i.$67l;if((M||n)&&p>=0&&h>=0){var w,F;if(M){var r=M.p(),v=M.getRotation();w=M.getPoints(),F=w.get(h),ch(M,r,v,p,F,!1)}else if(w=qh(j.getDataUI(n),n.s("edge.points"),!0),F=w.get(h),0===p){var c=w.get(0);
n.s("edge.source.offset.x",F.x-c.x),n.s("edge.source.offset.y",F.y-c.y)}else if(p===w.size()-1){var W=w.get(w.size()-1);n.s("edge.target.offset.x",F.x-W.x),n.s("edge.target.offset.y",F.y-W.y)}else"points"===n.s("edge.type")&&(w.set(p,F),n.s("edge.points",af(w)))}i.$47l(J);var l=i.$73l;1===B?(P&&P.beginInteraction(),l?j.sm().each(function(n){if(n.setHost&&j.isHelperEditable(n,"host")){n.setHost(l);var c=i.$75l,V=i.$74l;c&&(n.s("attach.row.index",c.rowIndex),n.s("attach.column.index",c.columnIndex)),V&&(n.s("attach.index",V.attachIndex),n.s("attach.offset",V.attachOffset),n.s("attach.offset.relative",!1),n.s("attach.offset.opposite",!1))}}):j.sm().each(function(K){K.setHost&&j.isHelperEditable(K,"host")&&(K.setHost(x),K.s("attach.row.index",_),K.s("attach.column.index",_),K.s("attach.index",_),K.s("attach.offset",_),K.s("attach.offset.relative",!1),K.s("attach.offset.opposite",!1))}),P&&P.endInteraction()):2===B?(P&&P.beginInteraction(),l?j.sm().each(function(J){J.setParent&&j.isHelperEditable(J,"parent")&&J.setParent(l)}):j.sm().each(function(J){J.setParent&&j.isHelperEditable(J,"parent")&&J.setParent(x)}),P&&P.endInteraction()):3===B?l&&(P&&P.beginInteraction(),j.sm().each(function(h){if(j.isHelperEditable(h,"edge")&&h instanceof Q&&l instanceof Q){var L=new $.Edge;O.add(L),L.setSource(h),L.setTarget(l),i.onEdgeCreated&&i.onEdgeCreated(J,L)}}),P&&P.endInteraction()):5===B||6===B?l&&(P&&P.beginInteraction(),j.sm().each(function(x){x instanceof A&&l instanceof Q&&(5===B&&j.isHelperEditable(x,"source")?x.setSource(l):6===B&&j.isHelperEditable(x,"source")&&x.setTarget(l))}),P&&P.endInteraction()):(7===B||8===B||9===B)&&P&&P.endInteraction(),(S||y)&&i.$43l(!0),R?(i.clear(),delete i.$64l,i._68I||i.$43l()):(i.handle_mousemove(J,!0),B&&!i._68I&&i.$43l())},handleWindowTouchMove:function(V){this.handleWindowMouseMove(V)},handleWindowMouseMove:function(D){this._78I(D)},handle_mousemove:function(G,I,r){if(!this._pause){if(!r){var f=R?lq(G):G;this.$61l={clientX:f.clientX,clientY:f.clientY}}if(I===!0||!n()){var K=this,P=K.gv,d=!1,X=x;K.clear(),P.sm().size()>0&&(X=P.lp(r?K.$61l:G),d=K._79I(G,X)),d&&(P._editing=1),K.$12l!==K.$65l&&(K.$65l=K.$12l,K.setCursor(K.$12l)),K.$40l!==K.$64l&&(K.$64l=K.$40l,K._68I||K.$43l()),K._hoverSegmentIndex!==K.$66l&&(K.$66l=K._hoverSegmentIndex,K._68I||K.$43l())}}},_78I:function(H){this.autoScroll(H);var E=this,k=E.gv,d=k.lp(H),j=k.getZoom(),D=E.$13l;if((E._shape||E._edge)&&D>=0){var i,a,Z,M=E._shape,v=E._edge,X=E.$24l,S=k.getPointSnapSpacing(),f=function(v,$){return S==x||isNaN(S)?{x:v,y:$}:{x:Y(v/S)*S,y:Y($/S)*S}};if(M){i=M.getPoints();var l=M.p(),e=M.getRotation(),n=0;a=rc(l,d.x-l.x,d.y-l.y,-e),ch(M,l,e,D,d,!0,X,f),E.fi({kind:"betweenEditPoint",event:H,data:M,index:D})}else if(v){i=qh(k.getDataUI(v),v.s("edge.points"),!0),d.x-=X.x,d.y-=X.y,a=d;var t,P,$=v.s("edge.offset"),r=i.size(),p=r>2;if(0===D){var R=i.get(0);$&&(R=vo(R,i.get(1),-$,p),d=vo(d,i.get(1),-$,p)),t=d.x-R.x,P=d.y-R.y,Z=f(t,P),v.s("edge.source.offset.x",Z.x),v.s("edge.source.offset.y",Z.y)}else if(D===r-1){var _=i.get(r-1);$&&(_=vo(_,i.get(r-2),-$,p),d=vo(d,i.get(r-2),-$,p)),t=d.x-_.x,P=d.y-_.y,Z=f(t,P),v.s("edge.target.offset.x",Z.x),v.s("edge.target.offset.y",Z.y)}else"points"===v.s("edge.type")&&(Z=f(d.x,d.y),Z.e=i.get(D).e,i.set(D,Z),v.s("edge.points",af(i)));E.fi({kind:"betweenEditPoint",event:H,data:v,index:D})}if(delete E.$9l,k.isSnapPoint(M)||k.isSnapPoint(v))for(n=0;n<i.size();n++)if(n!==D){var c=i.get(n);if(N(c,a)<k.getEditPointSize()/j){E.$9l=n;break}}}else if(E.$10l){var X=E.$24l;d.x-=X.x,d.y-=X.y;var h=k.sm().getSelection(),W=E.$1l,q=E.$7l,G=E.$10l,L=E.$4l,F=E.$2l,o=k.getEditRectPadding()/j,T=2*o,K=k.getSnapSpacing(),s=K!=x&&!isNaN(K),u=Jk(F,d,G,q,2*o,k.getResizeMode(),s,!0),B=E.$6l;if(s){var z=u.width-T,b=u.height-T,O=Y(z/K)*K,xi=Y(b/K)*K,Cc=O-z,Ng=xi-b;("west"===G||"northwest"===G||"southwest"===G)&&(Cc=-Cc),("north"===G||"northwest"===G||"northeast"===G)&&(Ng=-Ng),u=Jk(F,d,G,q,2*o,k.getResizeMode(),s,!1,Cc,Ng)}E.$8l=u,B.x=u.x+o,B.y=u.y+o,B.width=u.width-T,B.height=u.height-T;var Ih=u.x+u.width/2,Sb=u.y+u.height/2,Ug=B.x,nb=B.y,Vf=B.width/L.width,Hd=B.height/L.height;h.each(function(A){if(A instanceof Q&&k.isEditable(A)&&k.isRectEditable(A)){var $=W[A.getId()],X=E.$3l[A.getId()],b={x:$.x+$.width/2,y:$.y+$.height/2},n=0,L=0,U=G,p=180*I(q-A.getRotation())/m;"northeast"===G?p>=315||45>p?(n=$.width*Vf+$.x,L=$.height*(1-Hd)+$.y,U="northeast"):p>=45&&135>p?(n=$.width*(1-Hd)+$.x,L=$.height*(1-Vf)+$.y,U="northwest"):p>=135&&225>p?(n=$.width*(1-Vf)+$.x,L=$.height*Hd+$.y,U="southwest"):(n=$.width*Hd+$.x,L=$.height*Vf+$.y,U="southeast"):"north"===G?p>=315||45>p?(L=$.height*(1-Hd)+$.y,U="north"):p>=45&&135>p?(n=$.width*(1-Hd)+$.x,U="west"):p>=135&&225>p?(L=$.height*Hd+$.y,U="south"):(n=$.width*Hd+$.x,U="east"):"northwest"===G?p>=315||45>p?(n=$.width*(1-Vf)+$.x,L=$.height*(1-Hd)+$.y,U="northwest"):p>=45&&135>p?(n=$.width*(1-Hd)+$.x,L=$.height*Vf+$.y,U="southwest"):p>=135&&225>p?(n=$.width*Vf+$.x,L=$.height*Hd+$.y,U="southeast"):(n=$.width*Hd+$.x,L=$.height*(1-Vf)+$.y,U="northeast"):"west"===G?p>=315||45>p?(n=$.width*(1-Vf)+$.x,U="west"):p>=45&&135>p?(L=$.height*Vf+$.y,U="south"):p>=135&&225>p?(n=$.width*Vf+$.x,U="east"):(L=$.height*(1-Vf)+$.y,U="north"):"southwest"===G?p>=315||45>p?(n=$.width*(1-Vf)+$.x,L=$.height*Hd+$.y,U="southwest"):p>=45&&135>p?(n=$.width*Hd+$.x,L=$.height*Vf+$.y,U="southeast"):p>=135&&225>p?(n=$.width*Vf+$.x,L=$.height*(1-Hd)+$.y,U="northeast"):(n=$.width*(1-Hd)+$.x,L=$.height*(1-Vf)+$.y,U="northwest"):"east"===G?p>=315||45>p?(n=$.width*Vf+$.x,U="east"):p>=45&&135>p?(L=$.height*(1-Vf)+$.y,U="north"):p>=135&&225>p?(n=$.width*(1-Vf)+$.x,U="west"):(L=$.height*Vf+$.y,U="south"):"south"===G?p>=315||45>p?(L=$.height*Hd+$.y,U="south"):p>=45&&135>p?(n=$.width*Hd+$.x,U="east"):p>=135&&225>p?(L=$.height*(1-Hd)+$.y,U="north"):(n=$.width*(1-Hd)+$.x,U="west"):"southeast"===G&&(p>=315||45>p?(n=$.width*Vf+$.x,L=$.height*Hd+$.y,U="southeast"):p>=45&&135>p?(n=$.width*Hd+$.x,L=$.height*(1-Vf)+$.y,U="northeast"):p>=135&&225>p?(n=$.width*(1-Vf)+$.x,L=$.height*(1-Hd)+$.y,U="northwest"):(n=$.width*(1-Hd)+$.x,L=$.height*Vf+$.y,U="southwest"));var V=rc(b,n-b.x,L-b.y,A.getRotation());ln(A,$,U,{x:V.x,y:V.y});var w=Ug+B.width*X.x,H=nb+B.height*X.y,u={x:w,y:H};u=rc({x:Ih,y:Sb},u.x-Ih,u.y-Sb,q),A.p(u.x,u.y)}}),E.fi({kind:"betweenEditRect",event:H,direction:G})}else if(E.$23l&&E.$40l){var Zi=E.$8l,ok=Zi.width,In=Zi.height,l={x:Zi.x+ok/2,y:Zi.y+In/2},X=E.$24l,og=E.$23l,sd=og.x/j-l.x,mb=og.y/j-l.y,Zg=C(sd*sd+mb*mb),Qb=Math.asin(X.x/Zg),to=k.sm().getSelection(),Be=g+U(d.y-l.y,d.x-l.x)-Qb,Ci=k.getSnapAngle(),Be=Y(Be/Ci)*Ci;0>Be&&(Be+=w);var Nq=Be-E.$7l,Rj=[l.x,0,l.y];to.each(function(L){if(k.isEditable(L)&&k.isRotationEditable(L)&&k.isVisible(L)){var H=fk(L.p3(),Rj),g=lk();No(g,-Nq),L.setRotation(L.getRotation()+Nq),Rc(H,g),L.p3(Rj[0]+H[0],Rj[1]+H[1],Rj[2]+H[2])}}),E.$7l=Be,E.fi({kind:"betweenEditRotation",event:H})}else if([1,2,3,5,6].indexOf(E.$67l)>=0)E.$72l=H,E.$78l||(E.$78l=1,V(function(){J.isDragging()&&E.$43l(),delete E.$78l},12));else if(7===E.$67l){if(E.$87l instanceof y){var M=E.$87l,nh=E.$88l,Jm=J.clone(M.getPoints().get(nh)),fg=d.y-Jm.y;Jm.e||(Jm.e=0),E.$92l||(E.$92l=Jm.e),Jm.e=E.$92l-fg,M.setPoint(nh,Jm)}else if(E.$87l instanceof A){var v=E.$87l,nh=E.$88l,i=qh(k.getDataUI(v),v.s("edge.points")),Jm=i.get(nh),fg=d.y-Jm.y;Jm.e||(Jm.e=0),E.$92l||(E.$92l=Jm.e),Jm.e=E.$92l-fg,i.set(nh,Jm),v.s("edge.points",af(i))}}else if(8===E.$67l){var to=k.sm().getSelection(),mh=E.$93l;mh||(mh=E.$93l={}),to.each(function(l){if(l.p3){var p=l.p3(),h=mh[l.getId()];h==x&&(h=mh[l.getId()]=p[1]),l.p3([p[0],h-(d.y-E.$90l.y/j),p[2]])}})}else if(9===E.$67l){var to=k.sm().getSelection(),Ce=E.$94l;Ce||(Ce=E.$94l={}),to.each(function(H){if(H.s3){var i=H.s3(),c=Ce[H.getId()];c==x&&(c=Ce[H.getId()]=i[1]);var O=c-(d.y-E.$91l.y/j);0>O&&(O=.01),H.s3([i[0],O,i[2]])}})}},$79l:function(R,u){var $=this,G=$.gv,j=G.getZoom(),Z=G.getEditHelperSize(),Y=R.x/j,g=R.y/j,E=Z/j,X=E/2;return K({x:Y-X,y:g-X,width:E,height:E},u)?!0:void 0},getHelperCursor:function(){return"crosshair"},_79I:function(m,g){for(var D=this,G=D.gv,p=G.getZoom(),$=G.getEditPointSize(),n=$/p,O=n/2,l=D.$46l(m),Y=0;Y<l.length;Y++){var B,Z,i=l[Y],h=G.getDataUI(i);if(h&&h._55O){var u=h._55O;if(u._43O&&i instanceof A){if(B=i.s("edge.points"),B=qh(h,B),Z=i.s("edge.segments"),Z&&Z.size()||(Z=pc(B)),D.$42l(i,g,B._as,Z,"edge"))return!0;if("points"===i.s("edge.type"))return D.$41l(i,g,B._as,Z,"edge"),void 0}if(u._43O&&i instanceof y&&u.$15l&&u.$15l.length===i.getPoints().size()){if(B=u.$15l,Z=i.getSegments(),Z&&Z.size()||(Z=pc(B)),D.$42l(i,g,B,Z,"shape"))return!0;if(D.$41l(i,g,B,Z,"shape"))return}}}if(D.$16l){var B,J=D.$16l,E=J[3].x-J[7].x,w=J[3].y-J[7].y,V=C(E*E+w*w),T=J[1].x-J[5].x,f=J[1].y-J[5].y,e=C(T*T+f*f),L={x:g.x*p,y:g.y*p};if(D._80I(L,0,J[0],"northwest",V,e)||D._80I(L,1,J[1],"north",V,e)||D._80I(L,2,J[2],"northeast",V,e)||D._80I(L,7,J[7],"west",V,e)||D._80I(L,3,J[3],"east",V,e)||D._80I(L,6,J[6],"southwest",V,e)||D._80I(L,5,J[5],"south",V,e)||D._80I(L,4,J[4],"southeast",V,e))return!0}if(D.$23l){var P=D.$23l,U=P.x/p,x=P.y/p;if(K({x:U-O,y:x-O,width:n,height:n},g))return D.$40l=1,D.$12l=D.getHelperCursor("rotation")||"crosshair",!0}return D.$68l&&D.$79l(D.$68l,g)?(D.$67l=1,D.$12l=D.getHelperCursor("host")||"crosshair",!0):D.$69l&&D.$79l(D.$69l,g)?(D.$67l=2,D.$12l=D.getHelperCursor("parent")||"crosshair",!0):D.$70l&&D.$79l(D.$70l,g)?(D.$67l=3,D.$12l=D.getHelperCursor("edge")||"crosshair",!0):D.$71l&&D.$79l(D.$71l,g)?(D.$67l=4,D.$12l=D.getHelperCursor("remove")||"crosshair",!0):D.$82l&&D.$79l(D.$82l,g)?(D.$67l=5,D.$12l=D.getHelperCursor("source")||"crosshair",!0):D.$83l&&D.$79l(D.$83l,g)?(D.$67l=6,D.$12l=D.getHelperCursor("target")||"crosshair",!0):D._pointElevationHelperPoint&&D.$79l(D._pointElevationHelperPoint,g)?(D.$67l=7,D.$12l=D.getHelperCursor("pointElevation")||"crosshair",!0):D.$90l&&D.$79l(D.$90l,g)?(D.$67l=8,D.$12l=D.getHelperCursor("elevation")||"crosshair",!0):D.$91l&&D.$79l(D.$91l,g)?(D.$67l=9,D.$12l=D.getHelperCursor("tall")||"crosshair",!0):!1},_80I:function(x,b,s,t,g,w){var o=this,U=o.gv,V=U.getEditPointSize(),P=V/2,v=U.sm(),B=U.isDirectionEditable;if(B&&1===v.size()){var z=v.ld();if(B=B.bind(U),z instanceof Q){if(!B(z,t))return!1;if("east"===t){if(B(z,"northeast")&&B(z,"southeast")&&2*V>=w)return!1}else if("west"===t){if(B(z,"northwest")&&B(z,"southwest")&&2*V>=w)return!1}else if("north"===t){if(B(z,"northwest")&&B(z,"northeast")&&2*V>=g)return!1}else if("south"===t&&B(z,"southwest")&&B(z,"southeast")&&2*V>=g)return!1}}else{if(2*V>=g&&("north"===t||"south"===t))return!1;if(2*V>=w&&("east"===t||"west"===t))return!1}if(K({x:s.x-P,y:s.y-P,width:V,height:V},x)){if(o.$10l!==t){var h=180*o.$7l/m,T="";h>=337.5||22.5>h?T="north":h>=22.5&&67.5>h?T="northeast":h>=67.5&&112.5>h?T="east":h>=112.5&&157.5>h?T="southeast":h>=157.5&&202.5>h?T="south":h>=202.5&&247.5>h?T="southwest":h>=247.5&&292.5>h?T="west":h>=292.5&&337.5>h&&(T="northwest");var u=kp.indexOf(T),T=kp[b-(1-u)+8];switch(T){case"northwest":o.$12l="nwse-resize";break;case"northeast":o.$12l="nesw-resize";break;case"southwest":o.$12l="nesw-resize";break;case"southeast":o.$12l="nwse-resize";break;case"north":o.$12l="ns-resize";break;case"east":o.$12l="ew-resize";break;case"south":o.$12l="ns-resize";break;case"west":o.$12l="ew-resize"}o.$10l=t}return!0}return!1},$42l:function(j,B,w,l,b){var o,y=this,S=y.gv,D=S.getEditPointSize(),P=D/S.getZoom(),k=-1,R={x:B.x,y:B.y,width:0,height:0},u=function(m){"shape"===b?y._shape=j:y._edge=j,y._removePointIndex=m},O=function(v){"shape"===b?y._shape=j:y._edge=j,y.$13l=v,y.$12l="crosshair"};for(i(R,P/2),k=w.length-1,o=l.size()-1;o>=0;o--){var t=l.get(o);if(1===t||2===t)k-=1;else if(3===t){var s=w[k-1];if(K(R,s))return O(k-1),!0;k-=2}else if(4===t){var V=w[k-1],n=w[k-2];if(K(R,V))return O(k-1),!0;if(K(R,n))return O(k-2),!0;k-=3}}for(k=w.length-1,o=l.size()-1;o>=0;o--){var t=l.get(o),c=w[k];if(K(R,c))return u(k),O(k),!0;1===t||2===t?k-=1:3===t?k-=2:4===t&&(k-=3)}return!1},$41l:function(z,b,J,B,M){var p=this,Q=p.gv,N=-1,C=0,Y={x:b.x,y:b.y,width:0,height:0},U=function(r,s){p._hoverSegmentIndex=s,p._lp=b,"shape"===M?p._shape=z:p._edge=z};for(i(Y,Q.getSegmentHoverWidth()/2/Q.getZoom()),z instanceof y&&z.isClosePath()&&B.indexOf(5)<0&&(B=new W(B._as),B.add(5));C<B.size();C++){var l=B.get(C);if(1===l){var V=J[N],c=J[N+1];if(V){var a=Jm(new al(V.x,V.y),new al(c.x,c.y),new al(Y.x,Y.y),new al(Y.x+Y.width,Y.y+Y.height));if(a.$62l===f&&a.points.length>0)return U(a,C),!0}N+=1}else if(2===l){var V=J[N],c=J[N+1],a=Jm(new al(V.x,V.y),new al(c.x,c.y),new al(Y.x,Y.y),new al(Y.x+Y.width,Y.y+Y.height));if(a.$62l===f&&a.points.length>0)return U(a,C),!0;N+=1}else if(3===l){var V=J[N],h=J[N+1],T=J[N+2],a=ll(new al(V.x,V.y),new al(h.x,h.y),new al(T.x,T.y),new al(Y.x,Y.y),new al(Y.x+Y.width,Y.y+Y.height));if(a.$62l===f)return U(a,C),!0;N+=2}else if(4===l){var V=J[N],q=J[N+1],I=J[N+2],T=J[N+3],a=Mc(new al(V.x,V.y),new al(q.x,q.y),new al(I.x,I.y),new al(T.x,T.y),new al(Y.x,Y.y),new al(Y.x+Y.width,Y.y+Y.height));if(a.$62l===f)return U(a,C),!0;N+=3}else if(5===l){var V=J[N],c=J[0];if(V){var a=Jm(new al(V.x,V.y),new al(c.x,c.y),new al(Y.x,Y.y),new al(Y.x+Y.width,Y.y+Y.height));if(a.$62l===f&&a.points.length>0)return U(a,C),!0}}}return!1},addShapePoint:function(Q,R,D){var i=this,B=i.gv,g=B.dm(),z=g.getHistoryManager();if(z&&z.beginInteraction(),0===arguments.length&&(Q=i._shape||i._edge,R=i._hoverSegmentIndex,D=i._lp),Q instanceof y||Q instanceof A){var L=sq(Q,B.getDataUI(Q),R);if(!isNaN(R)&&D&&!isNaN(L)){var X=D;if(Q instanceof y){var E=Q.p(),H=Q.getRotation(),K=Q.toSegments();K&&K.size()||(K=pc(Q.getPoints())),Q.isClosePath()&&K.indexOf(5)<0&&(K=new W(K._as),K.add(5));var Y=K.get(R),v="addPoint",G="removePointAt";if(2===Y||1===Y){var d={x:X.x,y:X.y};K.add(Y,R),d=rc(E,d.x-E.x,d.y-E.y,-H),Q[v](d,L+1)}else if(3===Y){var t=Q.getPoints(),P=t.get(L),r=t.get(L+2),d={x:X.x,y:X.y};d=rc(E,d.x-E.x,d.y-E.y,-H);var N=dd(P,d),b=dd(d,r);K.removeAt(R),K.add(3,R),K.add(3,R),Q.setPoint(L+1,d),Q[v](b,L+2),Q[v](N,L+1)}else if(4===Y){var t=Q.getPoints(),P=t.get(L),r=t.get(L+3),d={x:X.x,y:X.y};d=rc(E,d.x-E.x,d.y-E.y,-H);var N=Lg(P,d),b=Ef(P,d),U=Lg(d,r),J=Ef(d,r);K.removeAt(R),K.add(4,R),K.add(4,R),Q[G](L+1),Q[G](L+1),Q[v](d,L+1),Q[v](J,L+2),Q[v](U,L+2),Q[v](b,L+1),Q[v](N,L+1)}else if(5===Y){var d={x:X.x,y:X.y};K.add(2,R),d=rc(E,d.x-E.x,d.y-E.y,-H),Q[v](d,L+1)}Q.isClosePath()&&K.remove(5),Q.setSegments(K);var o=Q.getWidth(),Z=Q.getHeight(),u=Q.p().x-o/2,n=Q.p().y-Z/2;u-=E.x,n-=E.y;var s=mk(Q,{x:u,y:n,width:o,height:Z},H,E);Q.p(s.x,s.y)}else if(Q instanceof A){if("points"!==Q.s("edge.type"))return z&&z.endInteraction(),void 0;var t=Q.s("edge.points");K=Q.s("edge.segments"),t=qh(B.getDataUI(Q),t),K&&K.size()||(K=pc(t)),K=new W(K._as.slice(0)),t=new W(t._as.slice(0));var Y=K.get(R);if(2===Y||1===Y){var d={x:X.x,y:X.y};K.add(Y,R),t.add(d,L+1)}else if(3===Y){var P=t.get(L),r=t.get(L+2),d={x:X.x,y:X.y},N=dd(P,d),b=dd(d,r);K.removeAt(R),K.add(3,R),K.add(3,R),t.set(L+1,d),t.add(b,L+2),t.add(N,L+1)}else if(4===Y){var P=t.get(L),r=t.get(L+3),d={x:X.x,y:X.y},N=Lg(P,d),b=Ef(P,d),U=Lg(d,r),J=Ef(d,r);K.removeAt(R),K.add(4,R),K.add(4,R),t.removeAt(L+1),t.removeAt(L+1),t.add(d,L+1),t.add(J,L+2),t.add(U,L+2),t.add(b,L+1),t.add(N,L+1)}Q.s("edge.points",af(t)),Q.s("edge.segments",K)}}}z&&z.endInteraction()},removeShapePoint:function(T,l){var K=this,d="removeAt",c=K.gv,x=c.dm(),z=x.getHistoryManager();if(z&&z.beginInteraction(),0===arguments.length&&(T=K._shape||K._edge,l=K._removePointIndex),l>=0&&(T instanceof y||T instanceof A)){var h=jb(T,K.gv.getDataUI(T),l),m=l;if(T instanceof y){var w=T.p(),k=T.toSegments();k&&k.size()||(k=pc(T.getPoints()));var v=k.get(h),o="removePointAt";if(1===v&&0===m)if(T.getPoints().size()>1){var n=k.get(h+1);k[d](h+1),3===n?T[o](m+1):4===n&&(T[o](m+2),T[o](m+1)),T[o](m)}else T.dm().remove(T);else 2===v||1===v?(k[d](h),T[o](m)):3===v?(k[d](h),T[o](m),T[o](m-1)):4===v&&(k[d](h),T[o](m),T[o](m-1),T[o](m-2));T.setSegments(k);var j=T.getWidth(),s=T.getHeight(),D=T.p().x-j/2,B=T.p().y-s/2;D-=w.x,B-=w.y;var G=mk(T,{x:D,y:B,width:j,height:s},T.getRotation(),w);T.p(G.x,G.y)}else if(T instanceof A){if("points"!==T.s("edge.type"))return z&&z.endInteraction(),void 0;var S=T.s("edge.points");if(k=T.s("edge.segments"),S&&(S=qh(K.gv.getDataUI(T),S),k&&k.size()||(k=pc(S))),0===l||l===S.size()-1)return z&&z.endInteraction(),void 0;k=new W(k._as.slice(0)),S=new W(S._as.slice(0));var v=k.get(h);2===v||1===v?(k[d](h),S[d](m)):3===v?(k[d](h),S[d](m),S[d](m-1)):4===v&&(k[d](h),S[d](m),S[d](m-1),S[d](m-2)),T.s("edge.segments",k),T.s("edge.points",af(S))}}z&&z.endInteraction()},changeShapeSegment:function(t,E,j){var D=this,_=D.gv,S=_.dm(),v=S.getHistoryManager();if(v&&v.beginInteraction(),1!==arguments.length||isNaN(t)||(j=t,t=D._shape||D._edge,E=D._hoverSegmentIndex),t instanceof y||t instanceof A){var M=sq(t,D.gv.getDataUI(t),E);if(!isNaN(E)&&!isNaN(M))if(t instanceof y){var o=t.p(),s=t.toSegments();s&&s.size()||(s=pc(t.getPoints()));var C=s.get(E),m=t.toPoints();if(1===j||2===j)1===C||2===C?s.set(E,j):3===C?(s.set(E,j),m.removeAt(M+1)):4===C&&(s.set(E,j),m.removeAt(M+1),m.removeAt(M+1));else if(3===j){var P=function(){var d=m.get(M),X=m.get(M+1),j=dd(d,X);s.set(E,3),m.add(j,M+1)};2===C||1===C?P():4===C&&(m.removeAt(M+1),m.removeAt(M+1),P())}else if(4===j){var G=function(){var r=m.get(M),l=m.get(M+1),z=Lg(r,l),H=Ef(r,l);s.set(E,4),m.add(z,M+1),m.add(H,M+2)};2===C||1===C?G():3===C&&(m.removeAt(M+1),G())}t.setSegments(s),t.setPoints(m);var k=t.getWidth(),g=t.getHeight(),H=t.p().x-k/2,a=t.p().y-g/2;H-=o.x,a-=o.y;var X=new mk(t,{x:H,y:a,width:k,height:g},t.getRotation(),o);t.p(X.x,X.y)}else if(t instanceof A){if("points"!==t.s("edge.type"))return v&&v.endInteraction(),void 0;var m=t.s("edge.points");s=t.s("edge.segments"),m&&(m=qh(D.gv.getDataUI(t),m),s&&s.size()||(s=pc(m))),s=new W(s._as.slice(0)),m=new W(m._as.slice(0));var C=s.get(E);if(1===j||2===j)1===C||2===C?s.set(E,j):3===C?(s.set(E,j),m.removeAt(M+1)):4===C&&(s.set(E,j),m.removeAt(M+1),m.removeAt(M+1));else if(3===j){var P=function(){var p=m.get(M),n=m.get(M+1),T=dd(p,n);s.set(E,3),m.add(T,M+1)};2===C||1===C?P():4===C&&(m.removeAt(M+1),m.removeAt(M+1),P())}else if(4===j){var G=function(){var J=m.get(M),$=m.get(M+1),P=Lg(J,$),r=Ef(J,$);s.set(E,4),m.add(P,M+1),m.add(r,M+2)};2===C||1===C?G():3===C&&(m.removeAt(M+1),G())}t.s("edge.points",af(m)),t.s("edge.segments",s)}}v&&v.endInteraction()},getDefaultSegments:function(L){var x=this.gv,X=x.getDataUI(L);if(L instanceof A){var G=L.s("edge.points");return G=qh(X,G),pc(G)}if(L instanceof y){var G=L.getPoints(),k=L.getSegments();return k&&k.size()>0?k:pc(G)}},$43l:function(U){var D=this;U&&(D.$5l=1),D._68I=1,D._42()},_42:function(){var M=this;if(M._68I){delete M._68I;var _=M.gv,r=M.$5l,l=_.getZoom(),F=_.getEditPointSize(),o=F/2,j=new W,g=M._view,X=M._edge,V=M._shape,Z=g.getContext("2d"),D=_.tx(),q=_.ty(),Y=x,d=_.getEditPointBackground(),H=_.getControlPointBackground(),S=_.getControlPointBorderColor(),n=_.getEditPointBorderColor(),R=_.getEditRectBorderColor(),b=_.getDirectionLineColor(),v=_.getSegmentHoverColor(),I=_.getSnapPointBorderColor(),U=_.getJoinPointBackground(),T=_.getJoinPointBorderColor(),e=_.getSegmentHoverWidth(),c=[5,5],t=_.getEditRectBorderStyle();xd(_,function(Q){_.isSelected(Q)&&_.isVisible(Q)&&j.add(Q)}),Z.clearRect(0,0,E(g.width),E(g.height)),Z.save(),P.translateAndScale(Z,D,q,1);var p=x,z={x:0,y:0,width:0,height:0},K=0,a=0,m=0,N=0,s=0,f=0,kr=0,ep=0,Pf=0,Gg=0,re=[];if(r?(delete M.$6l,delete M.$8l,delete M.$7l,delete M.$16l,delete M.$23l):(p=M.$6l,Y=M.$7l),delete M.$68l,delete M.$69l,delete M.$71l,delete M.$70l,delete M.$82l,delete M.$83l,delete M._pointElevationHelperPoint,delete M.$90l,delete M.$91l,delete M.$75l,delete M.$74l,j.each(function(j){var G=_.getDataUI(j);if(G){var b=G._55O;if(_.isEditable(j))b._56O&&j instanceof Q&&a++,re.push(j),b._42O&&j instanceof Q&&K++,_.isHelperEditable(j,"host")&&N++,_.isHelperEditable(j,"parent")&&m++,_.isHelperEditable(j,"remove")&&s++,_.isHelperEditable(j,"edge")&&f++,_.isHelperEditable(j,"source")&&kr++,_.isHelperEditable(j,"target")&&ep++,_.isHelperEditable(j,"elevation")&&Pf++,_.isHelperEditable(j,"tall")&&Gg++;else if(j instanceof B&&j.isExpanded()){var k=!0,D=_.getEditableFunc();D&&(k=D(j)),k&&(_.isHelperEditable(j,"host")&&N++,_.isHelperEditable(j,"parent")&&m++,_.isHelperEditable(j,"remove")&&s++,_.isHelperEditable(j,"edge")&&f++,_.isHelperEditable(j,"source")&&kr++,_.isHelperEditable(j,"target")&&ep++,_.isHelperEditable(j,"elevation")&&Pf++,_.isHelperEditable(j,"tall")&&Gg++,re.push(j))}}}),Z.beginPath(),Z.lineWidth=1,Z.strokeStyle=_.getNodeBorderColor(),re.forEach(function(s){var T=_.getDataUI(s),C=T._55O;if(r)if(Y==x&&(Y=s instanceof A?0:s instanceof B&&s.isExpanded()?0:s.getRotation(),M.$7l=Y),p==x){var b,g,w;if(s instanceof B&&s.isExpanded()||s instanceof A){var $=_.getDataUIBounds(s);g=$.width,w=$.height,b={x:$.x+g/2,y:$.y+w/2}}else b=s.p(),g=s.getWidth(),w=s.getHeight();p={x:b.x,y:b.y,width:0,height:0},z.x=b.x-g/2,z.y=b.y-w/2,z.width=g,z.height=w,p=L(p,z)}else{var b,g,w,V,D=p.x+p.width/2,k=p.y+p.height/2,F={x:D,y:k};if(s instanceof B&&s.isExpanded()||s instanceof A){V=0;var $=_.getDataUIBounds(s);g=$.width,w=$.height,b={x:$.x+g/2,y:$.y+w/2}}else b=s.p(),g=s.getWidth(),w=s.getHeight(),V=s.getRotation();var i={x:b.x-g/2,y:b.y-w/2,width:g,height:w},t={x:i.x,y:i.y},U={x:i.x+i.width,y:i.y},j={x:i.x,y:i.y+i.height},G={x:i.x+i.width,y:i.y+i.height},t=rc(b,t.x-b.x,t.y-b.y,V),j=rc(b,j.x-b.x,j.y-b.y,V),G=rc(b,G.x-b.x,G.y-b.y,V),U=rc(b,U.x-b.x,U.y-b.y,V),n=-Y,O=rc(F,t.x-F.x,t.y-F.y,n),H=rc(F,U.x-F.x,U.y-F.y,n),f=rc(F,j.x-F.x,j.y-F.y,n),I=rc(F,G.x-F.x,G.y-F.y,n),c=u([O,H,f,I]);p=L(p,c),p.x-=D,p.y-=k;var d=mk(x,p,Y,F);p.x=d.x-p.width/2,p.y=d.y-p.height/2}if(K>1&&_.isEditable(s)&&_.isRectEditable(s)&&s instanceof Q){var m=s.getRect(),a=C.$45l,q=Sc(a[0],l),P=Sc(a[2],l),X=Sc(a[4],l),y=Sc(a[6],l);s.getRotation()?(Z.moveTo(q.x,q.y),Z.lineTo(P.x,P.y),Z.lineTo(X.x,X.y),Z.lineTo(y.x,y.y),Z.lineTo(q.x,q.y)):Z.rect(m.x*l,m.y*l,m.width*l,m.height*l)}}),Z.stroke(),p){M.$6l=O(p),i(p,_.getEditRectPadding()/l);var be={x:p.x+p.width/2,y:p.y+p.height/2},cs=pj(be,p.width,p.height,Y),ie=cs[0],$q=cs[1],Qm=cs[2],Mn=cs[3],jr=cs[4],ac=cs[5],xf=cs[6],kj=cs[7];if(ie=Sc(cs[0],l),$q=Sc(cs[1],l),Qm=Sc(cs[2],l),Mn=Sc(cs[3],l),jr=Sc(cs[4],l),ac=Sc(cs[5],l),xf=Sc(cs[6],l),kj=Sc(cs[7],l),M.$8l=p,K>0&&(M.$16l=[ie,jr,$q,ac,Mn,xf,Qm,kj],Z.beginPath(),Z.lineWidth=1,Z.strokeStyle=R,"dashed"===t&&Z.setLineDash&&Z.setLineDash(c),Z.moveTo(ie.x,ie.y),Z.lineTo($q.x,$q.y),Z.lineTo(Mn.x,Mn.y),Z.lineTo(Qm.x,Qm.y),Z.lineTo(ie.x,ie.y),Z.stroke(),"dashed"===t&&Z.setLineDash&&Z.setLineDash([])),Z.beginPath(),Z.lineWidth=1,Z.fillStyle=d,Z.strokeStyle=n,K>0){var zr=ac.x-kj.x,bi=ac.y-kj.y,wm=C(zr*zr+bi*bi),wq=jr.x-xf.x,Rh=jr.y-xf.y,$o=C(wq*wq+Rh*Rh),Aj=2*F;if(_.isDirectionEditable&&1===re.length){var Kg=re[0],Of=_.getDataUI(Kg),Ik=Of._55O,od=_.isDirectionEditable.bind(_);if(Ik._42O){var bp,Hn,Ll,Cc;od(Kg,"northwest")&&(bp=!0,Z.rect(ie.x-o,ie.y-o,F,F)),od(Kg,"northeast")&&(Hn=!0,Z.rect($q.x-o,$q.y-o,F,F)),od(Kg,"southwest")&&(Ll=!0,Z.rect(Qm.x-o,Qm.y-o,F,F)),od(Kg,"southeast")&&(Cc=!0,Z.rect(Mn.x-o,Mn.y-o,F,F)),od(Kg,"north")&&(bp&&Hn?wm>Aj&&Z.rect(jr.x-o,jr.y-o,F,F):Z.rect(jr.x-o,jr.y-o,F,F)),od(Kg,"south")&&(Cc&&Ll?wm>Aj&&Z.rect(xf.x-o,xf.y-o,F,F):Z.rect(xf.x-o,xf.y-o,F,F)),od(Kg,"west")&&(Ll&&bp?$o>Aj&&Z.rect(kj.x-o,kj.y-o,F,F):Z.rect(kj.x-o,kj.y-o,F,F)),od(Kg,"east")&&(Cc&&Hn?$o>Aj&&Z.rect(ac.x-o,ac.y-o,F,F):Z.rect(ac.x-o,ac.y-o,F,F))}}else wm>Aj&&(Z.rect(jr.x-o,jr.y-o,F,F),Z.rect(xf.x-o,xf.y-o,F,F)),$o>Aj&&(Z.rect(ac.x-o,ac.y-o,F,F),Z.rect(kj.x-o,kj.y-o,F,F)),Z.rect(ie.x-o,ie.y-o,F,F),Z.rect($q.x-o,$q.y-o,F,F),Z.rect(Qm.x-o,Qm.y-o,F,F),Z.rect(Mn.x-o,Mn.y-o,F,F)}if(a>0){var ze=M.$23l=rc(jr,0,2*-F,Y);Z.moveTo(ze.x+o,ze.y),Z.arc(ze.x,ze.y,o,0,w,!1)}Z.fill(),Z.stroke(),M.$40l&&M.$44l(Z,p,Y);var Gh,Cb,fo=_.getLeftTopHelpers(),ym=_.getRightTopHelpers(),Zl=_.getLeftBottomHelpers(),ln=_.getRightBottomHelpers(),Mg=_.getEdgeHelpers(),Rf=_.getEditHelperSize(),ao=Rf/2,Md=function(j,S,L,C){"leftTop"===S?(Gh=p.x*l-Rf-o-("h"===C?L*(Rf+o):0)-1,Cb=p.y*l-Rf-o-("v"===C?L*(Rf+o):0)-1):"rightTop"===S?(Gh=(p.x+p.width)*l+o+("h"===C?L*(Rf+o):0)+1,Cb=p.y*l-Rf-o-("v"===C?L*(Rf+o):0)-1):"leftBottom"===S?(Gh=p.x*l-Rf-o-("h"===C?L*(Rf+o):0)-1,Cb=(p.y+p.height)*l+o+("v"===C?L*(Rf+o):0)+1):"rightBottom"===S&&(Gh=(p.x+p.width)*l+o+("h"===C?L*(Rf+o):0)+1,Cb=(p.y+p.height)*l+o+("v"===C?L*(Rf+o):0)+1);var J=Gh+ao,v=Cb+ao,D=(p.x+p.width/2)*l,X=(p.y+p.height/2)*l,K=rc({x:D,y:X},J-D,v-X,Y);if("host"===j){if(N>0)return M.$77l(Z,Y,K),!0}else if("edge"===j){if(f>0)return M.$80l(Z,Y,K),!0}else if("remove"===j){if(s>0)return re&&1===re.length&&re[0]instanceof A?M.$81l(Z,Y,{x:D+Rf/2+5,y:X}):M.$81l(Z,Y,K),!0}else if("parent"===j){if(m>0)return re&&1===re.length&&re[0]instanceof A?M.$76l(Z,Y,{x:D-Rf/2-5,y:X}):M.$76l(Z,Y,K),!0}else if("elevation"===j){if(Pf>0)return M.$85l(Z,Y,K),!0}else if("tall"===j){if(Gg>0)return M.$86l(Z,Y,K),!0}else if("source"===j||"target"===j){var h=re[0],I=_.getDataUI(h),n=li(I,!0),i=n[0],r=n[1];if(kr&&"source"===j)return M.$84l(Z,p,i,!0,h.isLooped(),S,L,C),!0;if(ep&&"target"===j)return M.$84l(Z,p,r,!1,h.isLooped(),S,L,C),!0}};if(fo&&fo.length>0){var Xp=0;fo.forEach(function(q){Md(q,"leftTop",Xp,_.getLeftTopHelpersAlign()||"h")&&Xp++})}if(ym&&ym.length>0){var Xp=0;ym.forEach(function(b){Md(b,"rightTop",Xp,_.getRightTopHelpersAlign()||"h")&&Xp++})}if(Zl&&Zl.length>0){var Xp=0;Zl.forEach(function(n){Md(n,"leftBottom",Xp,_.getLeftBottomHelpersAlign()||"h")&&Xp++})}if(ln&&ln.length>0){var Xp=0;ln.forEach(function(O){Md(O,"rightBottom",Xp,_.getRightBottomHelpersAlign()||"h")&&Xp++})}if(Mg&&Mg.length>0&&((kr||ep)&&re&&1===re.length&&re[0]instanceof A?!0:!1)){var Xp=0;Mg.forEach(function(b){Md(b,"edge",Xp,"h")&&Xp++})}if(M.$72l){var ii,vs=M.$67l,Bq=M.$68l,Ip=M.$69l,lm=(M.$71l,M.$70l),we=M.$82l,zk=M.$83l;if(1===vs?ii=Bq:2===vs?ii=Ip:3===vs?ii=lm:5===vs?ii=we:6===vs&&(ii=zk),ii){var Zk=_.lp(M.$72l),nc=_.getDataAt(M.$72l);if(nc&&nc instanceof Q){var ae,Cg,Te;if(M.$73l=nc,1===vs)if(nc instanceof $.Grid)ae=M.$75l=Ln(nc,Zk);else if(nc instanceof $.Shape){Te=M.$74l=Bn(nc,Zk);var Pk=nc.getPoints();if(Te){var of=Te.attachIndex,hm=sq(nc,_.getDataUI(nc),of)+1,np=hm+1>=Pk.size()?0:hm+1,vo=Pk.get(hm),Xk=Pk.get(np),Bl=nc.p(),ne=nc.getRotation();vo=rc(Bl,vo.x-Bl.x,vo.y-Bl.y,ne),Xk=rc(Bl,Xk.x-Bl.x,Xk.y-Bl.y,ne),Z.beginPath(),Z.strokeStyle=v,Z.lineWidth=e,Z.moveTo(vo.x*l,vo.y*l),Z.lineTo(Xk.x*l,Xk.y*l),Z.stroke()}}ae?Cg=ae.rect:(Cg=J.clone(_.getDataUIBounds(nc)),J.grow(Cg,2)),Z.beginPath(),Z.rect(Cg.x*l,Cg.y*l,Cg.width*l,Cg.height*l),Z.strokeStyle=1===vs||4===vs||6===vs?h:G,Z.lineWidth=2,Z.setLineDash&&Z.setLineDash([8,8]),Z.stroke()}else delete M.$73l;Zk.x=Zk.x*l,Zk.y=Zk.y*l;var Cm=em(ii.x,ii.y,Zk.x,Zk.y),te=rc(ii,Zk.x-ii.x,Zk.y-ii.y,-Cm),Vb=te.x-ii.x;Z.translate(ii.x,ii.y),Z.rotate(Cm),k.width=Vb,k.height=40;var Zb=G;(1===vs||4===vs||6===vs)&&(Zb=h),k.comps[0].gradientColor=Zb,J.drawImage(Z,k,0,-20,Vb,40)}}}if(j.each(function(s){var f=_.getDataUI(s);if(f){var N,u,O=f._55O,g=f._78o;if(O&&O._43O&&s instanceof y?(N=O.$15l,u=s.getSegments(),u&&u.size()||(u=pc(N)),s.isClosePath()&&u.indexOf(5)<0&&(u=new W(u._as),u.add(5))):O&&g&&O._43O&&(N=s.s("edge.points"),u=s.s("edge.segments"),N=qh(f,N),u&&u.size()||(u=pc(N)),N&&(N=N._as)),N&&u){var J=0,F=u.size(),q=M._hoverSegmentIndex;N=N.slice(0);for(var a=0;a<N.length;a++)N[a]=Sc(N[a],l);Z.beginPath(),Z.strokeStyle=b,Z.lineWidth=1,J=0;for(var a=0;F>a;a++){var $=u.get(a);if(1===$||2===$)J++;else if(3===$){var A=N[J-1],j=N[J],z=N[J+1];Z.moveTo(A.x,A.y),Z.lineTo(j.x,j.y),Z.lineTo(z.x,z.y),J+=2}else if(4===$){var A=N[J-1],Q=N[J],k=N[J+1],z=N[J+2];Z.moveTo(A.x,A.y),Z.lineTo(Q.x,Q.y),Z.moveTo(k.x,k.y),Z.lineTo(z.x,z.y),J+=3}}if(Z.stroke(),V===s||X===s&&"points"===X.s("edge.type")){Z.beginPath(),J=0,Z.strokeStyle=v,Z.lineWidth=e;for(var a=0;F>a;a++){var $=u.get(a);if(1===$||2===$){if(q===a){var A=N[J-1],z=N[J];Z.moveTo(A.x,A.y),Z.lineTo(z.x,z.y);break}J++}else if(3===$){if(q===a){var A=N[J-1],j=N[J],z=N[J+1];Z.moveTo(A.x,A.y),Z.quadraticCurveTo(j.x,j.y,z.x,z.y);break}J+=2}else if(4===$){if(q===a){var A=N[J-1],Q=N[J],k=N[J+1],z=N[J+2];Z.moveTo(A.x,A.y),Z.bezierCurveTo(Q.x,Q.y,k.x,k.y,z.x,z.y);break}J+=3}else if(5===$&&q===a){var A=N[J-1],z=N[0];Z.moveTo(A.x,A.y),Z.lineTo(z.x,z.y);break}}Z.stroke()}Z.beginPath(),J=0,Z.strokeStyle=T,Z.lineWidth=1,Z.fillStyle=U;for(var a=0;F>a;a++){var $=u.get(a);if(1===$||2===$){var z=N[J];Z.moveTo(z.x+o,z.y),Z.arc(z.x,z.y,o,0,w,!0),J++}else if(3===$){var z=N[J+1];Z.moveTo(z.x+o,z.y),Z.arc(z.x,z.y,o,0,w,!0),J+=2}else if(4===$){var z=N[J+2];Z.moveTo(z.x+o,z.y),Z.arc(z.x,z.y,o,0,w,!0),J+=3}}Z.fill(),Z.stroke(),Z.beginPath(),J=0,Z.strokeStyle=S,Z.lineWidth=1,Z.fillStyle=H;for(var a=0;F>a;a++){var $=u.get(a);if(1===$||2===$)J++;else if(3===$){var j=N[J];Z.moveTo(j.x+o,j.y),Z.arc(j.x,j.y,o,0,w,!0),J+=2}else if(4===$){var Q=N[J],k=N[J+1];Z.moveTo(Q.x+o,Q.y),Z.arc(Q.x,Q.y,o,0,w,!0),Z.moveTo(k.x+o,k.y),Z.arc(k.x,k.y,o,0,w,!0),J+=3}}if(Z.fill(),Z.stroke(),Z.beginPath(),J=0,Z.strokeStyle=I,Z.lineWidth=2,(V===s||X===s)&&M.$9l!=x){var z=N[M.$9l];Z.moveTo(z.x+o,z.y),Z.arc(z.x,z.y,o,0,w,!0),Z.stroke()}}}}),M.$87l&&_.sm().contains(M.$87l)){var tk,pq=M.$87l,Ap=M.$88l,Rf=_.getEditHelperSize(),ao=Rf/2;if(_.isHelperEditable(pq,"pointElevation"))if(pq instanceof y){var Th=pq.getPosition();tk=J.clone(pq.getPoints().get(Ap)),tk=rc({x:Th.x,y:Th.y},tk.x-Th.x,tk.y-Th.y,pq.getRotation()),tk.x*=l,tk.y*=l,Z.translate(tk.x,tk.y),J.drawImage(Z,J.getImage("xeditinteractor_elevationIcon"),ao,-ao,Rf,Rf),Z.translate(-tk.x,-tk.y),M._pointElevationHelperPoint={x:tk.x+Rf,y:tk.y}}else if(pq instanceof A){var Dg=qh(_.getDataUI(pq),pq.s("edge.points")),tk=J.clone(Dg.get(Ap));tk.x*=l,tk.y*=l,Z.translate(tk.x,tk.y),J.drawImage(Z,J.getImage("xeditinteractor_elevationIcon"),ao,-ao,Rf,Rf),Z.translate(-tk.x,-tk.y),M._pointElevationHelperPoint={x:tk.x+Rf,y:tk.y}}}Z.restore(),M.$5l=0}},$89l:function(V,X,y,b){V.save();var i=this,k=i.gv,Q=k.getEditHelperSize(),l=Q/2;V.beginPath(),V.translate(y.x,y.y),V.rotate(X),J.drawImage(V,b,-l,-l,Q,Q),V.restore()},$85l:function(W,l,A){var X=this;X.$90l=A,X.$89l(W,l,A,J.getImage("xeditinteractor_elevationIcon"))},$86l:function(B,q,k){var e=this;e.$91l=k,e.$89l(B,q,k,J.getImage("xeditinteractor_tallIcon"))},$77l:function(w,O,K){var H=this;H.$68l=K,H.$89l(w,O,K,J.getImage("xeditinteractor_hostIcon"))},$80l:function(u,I,v){var o=this;o.$70l=v,o.$89l(u,I,v,J.getImage("xeditinteractor_edgeIcon"))},$81l:function(A,o,P){var M=this;M.$71l=P,M.$89l(A,o,P,J.getImage("xeditinteractor_removeIcon"))},$76l:function(Z,G,y){var v=this;v.$69l=y,v.$89l(Z,G,y,J.getImage("xeditinteractor_parentIcon"))},$84l:function(D,w,n,i,b){var p,A=this,S=A.gv,G=S.getZoom(),H=S.getEditHelperSize(),q=H/2;n.x*=G,n.y*=G,b&&(i?n.x-=q+5:n.x+=q+5),n.y-=H-2,i?(A.$82l=n,p=J.getImage("xeditinteractor_sourceIcon")):(A.$83l=n,p=J.getImage("xeditinteractor_targetIcon")),D.beginPath(),D.translate(n.x,n.y),J.drawImage(D,p,-q,-q,H,H),D.translate(-n.x,-n.y)},$44l:function(V,b,X){V.save();var k=this.gv.getZoom(),G=C(s(b.width,2)+s(b.height,2))/2*k+10,A=G,N=A+8,x=A+18,M=X,w=b.x+b.width/2,R=b.y+b.height/2;V.translate(w*k,R*k),V.beginPath(),V.strokeStyle="rgb(150, 150, 150)";for(var e=0,p=0,L=0,H=0,t=0,D=0;360>D;D++)e=D*m/180,0===D%5&&(p=F(e)*A,L=q(e)*A,H=F(e)*N,t=q(e)*N,V.moveTo(p,L),V.lineTo(H,t)),0===D%45&&(p=F(e)*A,L=q(e)*A,H=F(e)*x,t=q(e)*x,V.moveTo(p,L),V.lineTo(H,t));V.stroke(),V.beginPath(),V.rotate(-g),V.beginPath(),V.fillStyle="rgba(255, 0, 0, 0.1)",V.strokeStyle="rgb(157, 157, 157)",V.moveTo(0,0),V.arc(0,0,x,0,X,!1),V.fill(),V.beginPath(),V.moveTo(0+x,0),V.arc(0,0,x,0,X,!1),V.stroke(),V.rotate(g),V.font="bold 12px Verdana, Arial";var W=20*q(M),v=20*F(M),T=Y(180*M/m)+"";V.textAlign="center",V.textBaseline="middle",V.beginPath();var B=V.measureText("365.").width;V.fillStyle="white",V.rect(W-B/2,-v-10,B,20),V.fill(),V.beginPath(),V.fillStyle="rgb(79,79,79)",V.fillText(T,W,-v),V.restore()
}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this,Object);