!function(Z,p){"use strict";var J=ht.AlarmSeverity=function(y,P,J,V,l){this.value=y,this.name=P,this.nickName=J,this.color=V,this.displayName=l};ht.Default.def("ht.AlarmSeverity",p,{toString:function(){return this.displayName||this.name}}),function(){J.severities=new ht.List,J._vm={},J._nm={},J._cp=function(d,I){if(d&&I){var z=d.value-I.value;return z>0?1:0>z?-1:0}return d&&!I?1:!d&&I?-1:0},J.each=function($,q){J.severities.each($,q)},J.getSortFunction=function(){return J._cp},J.setSortFunction=function(d){J._cp=d,J.severities.sort(d)},J.add=function(r,S,R,Q,F){var K=new J(r,S,R,Q,F);return J._vm[r]=K,J._nm[S]=K,J.severities.add(K),J.severities.sort(J._cp),K},J.remove=function(G){var z=J._nm[G];return z&&(delete J._nm[G],delete J._vm[z.value],J.severities.remove(z)),z},J.CRITICAL=J.add(500,"Critical","C","#FF0000"),J.MAJOR=J.add(400,"Major","M","#FFA000"),J.MINOR=J.add(300,"Minor","m","#FFFF00"),J.WARNING=J.add(200,"Warning","W","#00FFFF"),J.INDETERMINATE=J.add(100,"Indeterminate","N","#C800FF"),J.CLEARED=J.add(0,"Cleared","R","#00FF00"),J.isClearedAlarmSeverity=function(p){return p?0===p.value:!1},J.getByName=function(v){return J._nm[v]},J.getByValue=function(T){return J._vm[T]},J.clear=function(){J.severities.clear(),J._vm={},J._nm={}},J.compare=function(e,p){return J._cp(e,p)}}();var B=ht.AlarmState=function(G){this._d=G,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",p,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var L=null;for(var y in this._am)y=J.getByName(y),J.isClearedAlarmSeverity(y)||0!==this.getAcknowledgedAlarmCount(y)&&(L=L?J.compare(L,y)>0?L:y:y);this._haa=L},_c2:function(){var w=null;for(var K in this._nm)K=J.getByName(K),J.isClearedAlarmSeverity(K)||0!==this.getNewAlarmCount(K)&&(w=w?J.compare(w,K)>0?w:K:K);this._hna=w},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var y in this._nm)if(y=J.getByName(y),!J.isClearedAlarmSeverity(y)&&0!==this.getNewAlarmCount(y)&&J.compare(this._hna,y)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var A=this._haa,h=this._hna,e=this._ps;this._hoa=A,J.compare(h,this._hoa)>0&&(this._hoa=h),J.compare(e,this._hoa)>0&&(this._hoa=e)},_c5:function(){var C=this._haa,g=this._hna;this._hta=C,J.compare(g,this._hta)>0&&(this._hta=g)},increaseAcknowledgedAlarm:function(y,V){if(0!==V){V=V||1;var f=this._am[y.name]||0;f+=V,this._am[y.name]=f,this._f()}},increaseNewAlarm:function(D,B){if(0!==B){B=B||1;var C=this._nm[D.name]||0;C+=B,this._nm[D.name]=C,this._f()}},decreaseAcknowledgedAlarm:function(h,V){if(0!==V){V||(V=1);var G=this._am[h.name]||0;if(G-=V,0>G)throw"Alarm count can not be negative";this._am[h.name]=G,this._f()}},decreaseNewAlarm:function(w,f){if(0!==f){f||(f=1);var H=this._nm[w.name]||0;if(H-=f,0>H)throw"Alarm count can not be negative";this._nm[w.name]=H,this._f()}},acknowledgeAlarm:function(q){this.decreaseNewAlarm(q,1),this.increaseAcknowledgedAlarm(q,1)},acknowledgeAllAlarms:function(x){if(x){var B=this.getNewAlarmCount(x);this.decreaseNewAlarm(x,B),this.increaseAcknowledgedAlarm(x,B)}else for(var H in this._nm)this.acknowledgeAllAlarms(J.getByName(H))},_c6:function(){this._aac=0;for(var h in this._am)h=J.getByName(h),this._aac+=this.getAcknowledgedAlarmCount(h)},getAcknowledgedAlarmCount:function(u){return u?this._am[u.name]||0:this._aac},getAlarmCount:function(P){return this.getAcknowledgedAlarmCount(P)+this.getNewAlarmCount(P)},_c7:function(){this._nac=0;for(var Y in this._nm)this._nac+=this.getNewAlarmCount(J.getByName(Y))},getNewAlarmCount:function(P){return P?this._nm[P.name]||0:this._nac},setNewAlarmCount:function(D,X){this._nm[D.name]=X,this._f()},removeAllNewAlarms:function(i){i?delete this._nm[i]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(w,U){this._am[w.name]=U,this._f()},removeAllAcknowledgedAlarms:function(x){x?delete this._am[x.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(T){if(this._ep||(T=null),this._ps!==T){var C=this._ps;this._ps=T,this._f(),this._d.fp("propagateSeverity",C,T)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(c){var U=this._ep;this._ep=c,this._d.fp("enablePropagation",U,c)&&(c||this.setPropagateSeverity(null))}});var $=ht.AlarmStatePropagator=function(F){this._dataModel=F,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",p,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(b){this._enable!==b&&(this._enable=b,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(f){this.propagate(f)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(j){j.data&&this.propagate(j.data)},handleDataPropertyChange:function(S){if("alarmState"===S.property||"enablePropagation"===S.property)this.propagate(S.data);else if("parent"===S.property){var t=S.oldValue;t&&this.propagate(t),this.propagate(S.data)}},propagate:function(P){P&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(P),this._isPropagating=!1)},propagateToTop:function(s){for(this.propagateToParent(null,s);s&&s.getParent();)this.propagateToParent(s,s.getParent()),s=s.getParent()},propagateToParent:function(E,q){var K=null;q.getChildren().each(function(Z){var w=Z.getAlarmState().getHighestOverallAlarmSeverity();J.compare(w,K)>0&&(K=w)}),q.getAlarmState().setPropagateSeverity(K)}}),ht.AlarmStateStatistics=function(N){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(N)},ht.Default.def("ht.AlarmStateStatistics",p,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(a){var M=this._dataModel;M!==a&&(M&&(M.umd(this.handleDataPropertyChange,this),M.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=a,this.reset(),a.md(this.handleDataPropertyChange,this),a.mm(this.handleDataModelChange,this),this.fp("dataModel",M,a))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(v){"alarmState"===v.property&&(this.increase(v.data),this.fireAlarmStateChange())},handleDataModelChange:function(L){"add"===L.kind?(this.increase(L.data),this.fireAlarmStateChange()):"remove"===L.kind?(this.decrease(L.data),this.fireAlarmStateChange()):"clear"===L.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,J.each(function(j){var k=this.getSumInfo(j);this.sumAcked+=k.ackedCount,this.sumNew+=k.newCount,this.sumTotal+=k.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(e){if(!e)return this.sumNew;var n=this.getSumInfo(e);return n.newCount},getAcknowledgedAlarmCount:function(B){if(!B)return this.sumAcked;var Z=this.getSumInfo(B);return Z.ackedCount},getTotalAlarmCount:function(Z){if(!Z)return this.sumTotal;var d=this.getSumInfo(Z);return d.totalCount},getSumInfo:function(p){var d=this.severtiyMap[p.name];return d||(d={},d.newCount=0,d.ackedCount=0,d.totalCount=0,this.severtiyMap[p.name]=d),d},decrease:function(y){var Q=this.dataMap[y.getId()];Q&&(delete this.dataMap[y.getId()],J.each(function(R){var m=Q[R.name],D=this.getSumInfo(R);D.newCount=D.newCount-m.newCount,D.ackedCount=D.ackedCount-m.ackedCount,D.totalCount=D.totalCount-m.totalCount},this))},increase:function(l){if(this.decrease(l),!this._filterFunc||this._filterFunc(l)){var z={},Q=l.getAlarmState();this.dataMap[l.getId()]=z,J.each(function(j){var y={};y.newCount=Q.getNewAlarmCount(j),y.ackedCount=Q.getAcknowledgedAlarmCount(j),y.totalCount=Q.getAlarmCount(j),z[j.name]=y;var T=this.getSumInfo(j);T.newCount=T.newCount+y.newCount,T.ackedCount=T.ackedCount+y.ackedCount,T.totalCount=T.totalCount+y.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(k){var t=this._filterFunc;this._filterFunc=k,this.reset(),this.firePropertyChange("filterFunc",t,k)},getFilterFunc:function(){return this._filterFunc}});var z=ht.Data.prototype;z.getAlarmState=function(){return this._alarmState||(this._alarmState=new B(this))},z=ht.DataModel.prototype,z.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},z.setEnableAlarmStatePropagator=function(z){z!=this.isEnableAlarmStatePropagator()&&(z?(this._alarmStatePropagator=new $(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},z=ht.graph.GraphView.prototype,z.getNote2=function(Y){var R=Y.getAlarmState().getHighestNewAlarmSeverity();if(R){var Z=Y.getAlarmState().getNewAlarmCount(R)+R.nickName;return Y.getAlarmState().hasLessSevereNewAlarms()&&(Z+="+"),Z}return Y.s("note2")},z.getNote2Background=function(U){var O=U.getAlarmState().getHighestNewAlarmSeverity();return O?O.color:U.s("note2.background")},z.getBodyColor=function(l){var w=l.getAlarmState().getHighestNativeAlarmSeverity();return w?w.color:l.s("body.color")},z.getBorderColor=function(W){var C=W.getAlarmState().getPropagateSeverity();return C?C.color:W.s("border.color")},z=ht.widget.TreeView.prototype,z.getBorderColor=function(b){var C=b.getAlarmState().getPropagateSeverity();return C?C.color:b.s("border.color")},z.getIcon=function(T){return T.getIcon()?"__alarmIcon__":null},z=ht.widget.TreeTableView.prototype,z.getBorderColor=function(C){var w=C.getAlarmState().getPropagateSeverity();return w?w.color:C.s("border.color")},z.getIcon=function(r){return r.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(l){return l.getIcon()}},color:{func:function(A){var c=A.getAlarmState().getHighestNativeAlarmSeverity();return c?c.color:A.s("body.color")}},rect:[0,0,16,16]}]});var X=ht.Style;X["note2.expanded"]=!0,X["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this,Object);