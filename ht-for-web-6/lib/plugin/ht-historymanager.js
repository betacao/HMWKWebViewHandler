!function(y,C){"use strict";var k="ht",Y=y[k],V=Y.Default,B=V.def,r="add",n="remove",e=V.getInternal(),u="propertyChange";Y.HistoryManager=function(r){this._histories=[],this.setDataModel(r)},B(Y.HistoryManager,C,{ms_ac:["dataModel","histories","historyIndex","maxHistoryCount"],ms_fire:1,_historyIndex:-1,$4p:0,$8p:0,_maxHistoryCount:10,beginInteraction:function(){var p=this;p.$4p++,1===p.$4p&&(p.$3p=[])},endInteraction:function(){var k=this,F=k._histories,o=k._historyIndex,M=k.$3p;k.$4p>0&&k.$4p--,0===k.$4p&&(delete k.$3p,M&&M.length&&(F=F.slice(0,o+1),F.push(M),F.length>k._maxHistoryCount&&(F=F.slice(F.length-k._maxHistoryCount)),k.setHistories(F),k.setHistoryIndex(F.length-1,!0)))},beginTransient:function(){this.$4p||this.$8p++},endTransient:function(){this.$4p||this.$8p--},setDataModel:function(k){var g=this,I=g._dataModel;I!==k&&(I&&(delete I._historyManager,I.umm(g.$5p,g),I.umd(g.$6p,g)),g._dataModel=k,k._historyManager=g,k.mm(g.$5p,g),k.md(g.$6p,g),g.fp("dataModel",I,k),g.clear())},setHistoryIndex:function(N,q){var v=this,x=v._historyIndex,m=v._histories.length;if(-1>N?N=-1:N>=m&&(N=m-1),x!==N){if(!q){var C=N-x;C>0?v.$2p(C):0>C&&v.$1p(-C)}v._historyIndex=N,v.fp("historyIndex",x,N)}},setMaxHistoryCount:function(x){var J=this,U=J._histories,$=J._maxHistoryCount;(!x||0>=x)&&(x=10),$!==x&&(J._maxHistoryCount=x,J.fp("maxHistoryCount",$,x),U.length>x&&J.clear())},isPropertyRecode:function(){return!0},$5p:function(L){if(!this.$7p&&!this.$8p){var T,V,F=this,a=F._histories,h=L.kind,D=L.property,S=F._historyIndex;if(h===r||h===n?V={type:L.kind,data:L.data}:F.isPropertyRecode(D)&&D&&"children"!==D&&"attaches"!==D&&"shape"!==D&&"*"!==D&&(V={type:u,data:L.data,property:D,oldValue:L.oldValue,newValue:L.newValue}),V)if(F.$4p){T=F.$3p;var q=!1;if(V.type===u)for(var Z=T.length-1;Z>=0;Z--){var s=T[Z];if(s.type!==u)break;V.property===s.property&&s.property&&V.data===s.data&&(V.oldValue=s.oldValue,T[Z]=V,q=!0)}q||T.push(V)}else T=[V],a=a.slice(0,S+1),a.push(T),a.length>F._maxHistoryCount&&(a=a.slice(a.length-F._maxHistoryCount)),F.setHistories(a),F.setHistoryIndex(a.length-1,!0)}},$6p:function(Q){this.$5p(Q)},undo:function(z){(!z||0>=z)&&(z=1),this.setHistoryIndex(this._historyIndex-z)},$1p:function(N){var y,Q=this,X=Q._dataModel,h=Q._histories,D=Q._historyIndex;for(Q.$7p=1,V.setIsolating(!0);N>0;){if(D>=0&&D<h.length){y=h[D],D--;for(var z=y.length-1;z>=0;z--){var G=y[z],a=G.type,K=G.data,T=G.property,B=G.oldValue;if(a===r)X.remove(K);else if(a===n)X.add(K);else{var L=null;0===T.indexOf("a:")?(L="attr",T=T.replace("a:","")):0===T.indexOf("s:")&&(L="style",T=T.replace("s:","")),e.setPropertyValue(K,L,T,B)}}}N--}V.setIsolating(!1),delete Q.$7p},redo:function(c){(!c||0>=c)&&(c=1),this.setHistoryIndex(this._historyIndex+c)},$2p:function(H){var L,y=this,$=y._dataModel,W=y._histories,B=y._historyIndex;for(y.$7p=1,V.setIsolating(!0);H>0;){if(B>=-1&&B<W.length-1){B++,L=W[B];for(var g=0;g<L.length;g++){var Y=L[g],t=Y.type,k=Y.data,I=Y.property,Z=Y.newValue;if(t===r)$.add(k);else if(t===n)$.remove(k);else{var u=null;0===I.indexOf("a:")?(u="attr",I=I.replace("a:","")):0===I.indexOf("s:")&&(u="style",I=I.replace("s:","")),e.setPropertyValue(k,u,I,Z)}}}H--}V.setIsolating(!1),delete y.$7p},clear:function(){this.setHistories([]),this.setHistoryIndex(-1,!0),this.$4p=0,delete this.$3p}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this,Object);