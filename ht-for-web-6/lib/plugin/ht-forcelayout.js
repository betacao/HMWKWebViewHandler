!function(w,k){"use strict";var G="ht",g=G+".layout.",v=w[G]||module.parent.exports.ht,S=v.List,f=v.DataModel,Q=v.Node,K=v.Edge,F=v.Group,P=Math,q=P.sqrt,L=P.random,h=P.max,e=P.min,T=function(_){return _*_};v.Default.getInternal().addMSMap({ms_force:function(W){W._interval=50,W._stepCount=10,W._motionLimit=.01,W._edgeRepulsion=.65,W._nodeRepulsion=.65,W._damper=1,W._maxMotion=0,W._motionRatio=0,W.init=function(W){var p=this;W instanceof f?p.dm=W:p.gv=W,p._nodeMap={},p._nodes=new S,p._edges=new S},W.start=function(){var X=this,d=X.gv;if(!X._timer){var f=X.cdm=d?d.dm():X.dm;f.mm(X.handleDataModelChange,X),f.md(X.handleDataPropertyChange,X),d&&d.mp(X.handleGV,X),f.each(function(f){if(X.isVisible(f)&&X.isLayoutable(f)&&f instanceof Q)if(X instanceof s){var S=f.p3();f.p3([S[0]+L(),S[1]+L(),S[2]+L()])}else S=f.p(),f.p(S.x+L(),S.y+L())}),X._timer=setInterval(function(){X.relax()},X._interval),X._damper=1}},W.stop=function(){var E=this;E._timer&&(E.cdm.umm(E.handleDataModelChange,E),E.cdm.umd(E.handleDataPropertyChange,E),E.gv&&E.gv.ump(E.handleGV,E),clearInterval(E._timer),delete E._timer,delete E.cdm)},W.handleGV=function(Q){var L=this;if("dataModel"===Q.property){var P=Q.oldValue,B=Q.newValue;P&&(P.umm(L.handleDataModelChange,L),P.umd(L.handleDataPropertyChange,L)),this.cdm=B,B.mm(L.handleDataModelChange,L),B.md(L.handleDataPropertyChange,L)}},W.relax=function(){var C=this;if(!(C._damper<.1&&C._maxMotion<C._motionLimit)){this.cdm.each(function(g){C.isVisible(g)&&(g instanceof K?C.addEdge(g):g instanceof Q&&C.addNode(g))});for(var _,N,r=0,L=C._edges,e=C._nodes,o=e.size();r<C._stepCount;r++){for(L.each(C.relaxEdge,C),_=0;o>_;_++)for(N=0;o>N;N++)C.relaxNode(e.get(_),e.get(N));C.moveNode()}C._isAdjusting=1,e.each(function(J){J.fix||(J.p?J.v.p3(J.p):J.v.p(J.x,J.y))}),delete C._isAdjusting,C._nodeMap={},e.clear(),L.clear(),C.onRelaxed()}},W.onRelaxed=function(){},W.isRunning=function(){return!!this._timer},W.isVisible=function(d){return d.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(d):!0},W.isLayoutable=function(x){if(x.s("layoutable")===!1)return!1;if(x instanceof F)return!1;var f=this;return f.gv?f.gv.isMovable(x)&&!f.gv.isSelected(x):!(f.cdm||f.dm).sm().co(x)},W.getNodeRepulsion=function(){return this._nodeRepulsion},W.setNodeRepulsion=function(B){this._nodeRepulsion=B,this._damper=1},W.getEdgeRepulsion=function(){return this._edgeRepulsion},W.setEdgeRepulsion=function(v){this._edgeRepulsion=v,this._damper=1},W.getStepCount=function(){return this._stepCount},W.setStepCount=function(I){this._stepCount=I,this._damper=1},W.getInterval=function(){return this._interval},W.setInterval=function(Y){var f=this;f._interval!==Y&&(f._interval=Y,f._timer&&(clearInterval(f._timer),f._timer=setInterval(function(){f.relax()},Y)))},W.handleDataPropertyChange=function(B){!this._isAdjusting&&this.isVisible(B.data)&&(this._damper=1)},W.handleDataModelChange=function(){this._damper=1},W.damp=function(){var E=this._maxMotion,x=this._damper;this._motionRatio<=.001&&((.2>E||E>1&&.9>x)&&x>.01?this._damper-=.01:.4>E&&x>.003?this._damper-=.003:x>1e-4&&(this._damper-=1e-4)),E<this._motionLimit&&(this._damper=0)}}}),v.layout.ForceLayout=function(Y){this.init(Y)},v.Default.def(g+"ForceLayout",k,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(E){this._limitBounds=E,this._damper=1},getNodeSize:function(o){var S=this.gv;return S&&S.getDataUIBounds?S.getDataUIBounds(o):o.getRect()},addNode:function(H){var y=this,Y=y._nodeMap[H._id];if(Y)return Y;var b=H.p();Y={v:H,x:b.x,y:b.y,dx:0,dy:0,fix:!y.isLayoutable(H),s:y.getNodeSize(H)};var e=Y.s,Q=q(T(e.width)+T(e.height))*y._nodeRepulsion;return Y.r=1>Q?100:Q,y._nodeMap[H._id]=Y,y._nodes.add(Y),Y},addEdge:function(V){if(V._40I&&V._41I){var r=this,G=r.addNode(V._40I),k=r.addNode(V._41I),K={s:G,t:k};k=k.s,G=G.s;var N=k.width+G.width,x=k.height+G.height;K.length=q(N*N+x*x)*r._edgeRepulsion,K.length<=0&&(K.length=100),r._edges.add(K)}},relaxEdge:function(I){var S=I.t,J=I.s,Z=S.x-J.x,t=S.y-J.y,i=q(Z*Z+t*t),b=100*I.length,x=.25*Z/b*i,H=.25*t/b*i;S.dx=S.dx-x,S.dy=S.dy-H,J.dx=J.dx+x,J.dy=J.dy+H},relaxNode:function(x,Z){if(x!==Z){var Q=0,u=0,O=x.x-Z.x,_=x.y-Z.y,k=O*O+_*_;0===k?(Q=L(),u=L()):36e4>k&&(Q=O/k,u=_/k);var c=x.r*Z.r/400;Q*=c,u*=c,x.dx+=Q,x.dy+=u,Z.dx-=Q,Z.dy-=u}},moveNode:function(){var x=this,k=x._limitBounds,y=x._maxMotion,j=0,X=x._damper;x._nodes.each(function(_){if(!_.fix){var t=_.dx*X,n=_.dy*X;if(_.dx=t/2,_.dy=n/2,j=h(q(t*t+n*n),j),_.x+=h(-40,e(40,t)),_.y+=h(-40,e(40,n)),k){_.x<k.x&&(_.x=k.x,x.adjust(1,0)),_.y<k.y&&(_.y=k.y,x.adjust(0,1));var Y=_.s;_.x+Y.width>k.x+k.width&&(_.x=k.x+k.width-Y.width,x.adjust(-1,0)),_.y+Y.height>k.y+k.height&&(_.y=k.y+k.height-Y.height,x.adjust(0,-1))}}}),x._maxMotion=j,x._motionRatio=j>0?y/j-1:0,x.damp()},adjust:function(t,c){var O=this._limitBounds;this._nodes.each(function(v){t>0?(!O||v.x+v.s.width+t<O.x+O.width)&&(v.x+=t):(!O||v.x+t>O.x)&&(v.x+=t),c>0?(!O||v.y+v.s.height+c<O.y+O.height)&&(v.y+=c):(!O||v.y+c>O.y)&&(v.y+=c)})}});var s=v.layout.Force3dLayout=function(i){this.init(i)};v.Default.def(g+"Force3dLayout",k,{ms_force:1,getNodeSize3d:function(h){return h.s3()},addNode:function(F){var q=this,S=q._nodeMap[F._id];if(S)return S;S={v:F,p:F.p3(),d:[0,0,0],fix:!q.isLayoutable(F),s:q.getNodeSize3d(F)};var a=S.s,k=v.Default.getDistance(a)*q._nodeRepulsion;return S.r=1>k?100:k,q._nodeMap[F._id]=S,q._nodes.add(S),S},addEdge:function(G){if(G._40I&&G._41I){var C=this,H=C.addNode(G._40I),i=C.addNode(G._41I),S={s:H,t:i};i=i.s,H=H.s,S.length=q(T(i[0]+H[0])+T(i[1]+H[1])+T(i[2]+H[2]))*C._edgeRepulsion,S.length<=0&&(S.length=100),C._edges.add(S)}},relaxEdge:function(m){var j=m.t.p,N=m.s.p,h=m.t.d,G=m.s.d,p=j[0]-N[0],t=j[1]-N[1],Q=j[2]-N[2],Y=q(p*p+t*t+Q*Q),L=100*m.length,T=.25*p/L*Y,f=.25*t/L*Y,J=.25*Q/L*Y;h[0]-=T,h[1]-=f,h[2]-=J,G[0]+=T,G[1]+=f,G[2]+=J},relaxNode:function(C,z){if(C!==z){var Z=C.p,f=z.p,o=0,K=0,p=0,S=Z[0]-f[0],P=Z[1]-f[1],x=Z[2]-f[2],u=S*S+P*P+x*x;0===u?(o=L(),K=L(),p=L()):216e6>u&&(o=S/u,K=P/u,p=x/u);var w=C.r*z.r/400,W=C.d,t=z.d;o*=w,K*=w,p*=w,W[0]+=o,W[1]+=K,W[2]+=p,t[0]-=o,t[1]-=K,t[2]-=p}},moveNode:function(){var o=this,M=o._maxMotion,X=0,x=o._damper;o._nodes.each(function(O){if(!O.fix){var E=O.p,U=O.d,d=U[0]*x,W=U[1]*x,D=U[2]*x;U[0]=d/2,U[1]=W/2,U[2]=D/2,X=h(q(d*d+W*W+D*D),X),E[0]+=h(-40,e(40,d)),E[1]+=h(-40,e(40,W)),E[2]+=h(-40,e(40,D))}}),o._maxMotion=X,o._motionRatio=X>0?M/X-1:0,o.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this,Object);